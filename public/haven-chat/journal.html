<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal - Haven</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 25%, #FF9A8B 50%, #E8447A 75%, #FF8C42 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 98%;
            margin: 0 auto;
            padding: 0 1px;
            padding-bottom: 120px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
        }

        .header h1 {
            color: white;
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            color: white;
            font-size: 1.1em;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px 25px 100px 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #FF6B8A;
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.2em;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #eee;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px;
            border-radius: 8px;
            text-decoration: none;
            color: #666;
        }

        .nav-item:hover {
            background: #f5f5f5;
        }

        .nav-item.active {
            background: #FF6B8A !important;
            color: white !important;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .nav-item:nth-child(1) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3C/svg%3E");
        }

        .nav-item:nth-child(2) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z'/%3E%3C/svg%3E");
        }

        .nav-item:nth-child(3) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z'/%3E%3C/svg%3E");
        }

        .nav-item:nth-child(4) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3E%3C/svg%3E");
        }

        .nav-item:nth-child(5) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z'/%3E%3C/svg%3E");
        }

        .nav-item:nth-child(6) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E");
        }

        .nav-item:nth-child(7) .nav-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .nav-item:hover .nav-icon,
        .nav-item.active .nav-icon {
            filter: brightness(0) invert(1) !important;
        }

        .nav-label {
            font-size: 14px;
            text-align: center;
        }

        .footer-banner {
            background: #f8f9fa;
            padding: 5.5px;
            text-align: center;
            border-top: 1px solid #e9ecef;
            width: 100%;
        }

        .footer-text {
            color: #666666;
            font-size: 9.975px;
            line-height: 1.4;
        }

        /* Plan Upgrade Overlay */
        .plan-upgrade-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .upgrade-modal {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .upgrade-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upgrade-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .upgrade-message {
            color: #666;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .upgrade-button {
            background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .upgrade-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 138, 0.3);
        }

        /* Insights Grid */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .insight-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .insight-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%);
            border-radius: 50%;
            margin: 0 auto 15px;
        }

        .insight-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .insight-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .insight-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FF6B8A;
            margin-bottom: 5px;
        }

        .insight-description {
            font-size: 0.9rem;
            color: #666;
        }

        /* Reflection Input */
                .reflection-input {
            width: 100%;
            min-height: 500px;
            padding: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 0;
            font-size: 18px;
            line-height: 2.0;
            resize: vertical;
            transition: all 0.3s;
            font-family: 'Caveat', 'Comic Sans MS', cursive, sans-serif;
            background: #fefefe;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            background-image:
                linear-gradient(#f8f8f8 1px, transparent 1px),
                linear-gradient(90deg, #f8f8f8 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 0 0;
        }

        .reflection-input:focus {
            outline: none;
            border-color: #FF6B8A;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1), 0 0 0 3px rgba(255, 107, 138, 0.1);
        }

        .save-btn {
            background: #FF6B8A;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .save-btn:hover {
            background: #e55a7a;
            transform: translateY(-2px);
        }

        /* Mood Grid */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .mood-item {
            text-align: center;
            cursor: pointer;
            padding: 15px;
            border-radius: 12px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .mood-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .mood-item.selected {
            border-color: #FF6B8A;
            background: #fff5f7;
        }

        .mood-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .mood-label {
            font-size: 0.9rem;
            color: #666;
        }

        .mood-item.selected .mood-label {
            color: #FF6B8A;
            font-weight: bold;
        }

        /* Entry Filters */
        .entry-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: #f8f9fa;
            border: 2px solid #f0f0f0;
            color: #666;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: #FF6B8A;
            color: white;
            border-color: #FF6B8A;
        }

        /* Practice Checklists */
        .practice-checklists-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .practice-checklist {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .practice-checklist:hover {
            border-color: #FF6B8A;
            box-shadow: 0 4px 15px rgba(255, 107, 138, 0.1);
        }

        .practice-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .practice-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
        }

        .practice-title {
            color: #333;
            font-size: 1.2em;
            font-weight: bold;
            margin: 0;
        }

        .practice-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: rgba(255, 107, 138, 0.05);
        }

        .checklist-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #FF6B8A;
        }

        .checklist-label {
            flex: 1;
            font-size: 0.95em;
            color: #333;
            cursor: pointer;
        }

        .checklist-item.completed .checklist-label {
            text-decoration: line-through;
            color: #999;
        }

        .practice-progress {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.85em;
            color: #666;
            text-align: center;
        }

        /* Compassion Badge Display */
        .compassion-badge-display {
            margin-bottom: 20px;
            animation: slideInDown 0.5s ease-out;
        }

        .badge-earned-notification {
            background: linear-gradient(135deg, #FFD93D 0%, #FFE566 100%);
            border: 3px solid #FF6B8A;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 138, 0.2);
            animation: badgePulse 2s ease-in-out infinite;
        }

        .badge-earned-notification .badge-icon {
            font-size: 2.5em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .badge-content {
            flex: 1;
        }

        .badge-title {
            color: #333;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .badge-description {
            color: #555;
            font-size: 0.9em;
            line-height: 1.4;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }

        /* Mood Colors Generator */
        .mood-input-section {
            margin-bottom: 25px;
        }

        .mood-input-label {
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        .mood-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            background: #f8f9fa;
        }

        .mood-textarea:focus {
            outline: none;
            border-color: #FF6B8A;
            background: white;
        }

        .intensity-section {
            margin-bottom: 25px;
        }

        .intensity-label {
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        .intensity-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #ff6b6b 0%, #ffd93d 50%, #51cf66 100%);
            outline: none;
            -webkit-appearance: none;
        }

        .intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid #FF6B8A;
            cursor: pointer;
        }

        .intensity-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85em;
            color: #666;
        }

        .intensity-buttons {
            display: flex;
            gap: 8px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .intensity-btn {
            padding: 8px 12px;
            border: 2px solid #FF6B8A;
            background: white;
            color: #FF6B8A;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .intensity-btn:hover {
            background: #FF6B8A;
            color: white;
            transform: scale(1.05);
        }

        .intensity-btn.selected {
            background: #FF6B8A;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 138, 0.3);
        }

        .generate-mood-button {
            background: #FF6B8A;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .generate-mood-button:hover {
            background: #e55a7a;
            transform: translateY(-2px);
        }

        .mood-palettes-section {
            margin-top: 30px;
        }

        .mood-palettes-title {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: left;
        }

        .mood-palettes-container {
            min-height: 100px;
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-style: italic;
        }

        /* Emotional Palette Styles */
        .section-subtitle {
            color: #666;
            font-size: 1rem;
            margin-bottom: 25px;
            text-align: center;
            font-style: italic;
        }

        .emotional-palette-container {
            max-width: 100%;
        }

        .color-guide {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .color-guide h3 {
            color: #333;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .color-guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .color-guide-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .color-guide-swatch {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .color-guide-item span {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.4;
        }

        .emotional-process {
            margin-top: 30px;
        }

        .process-explanation {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #FF6B8A, #FFD93D);
            color: white;
            border-radius: 12px;
            font-size: 1rem;
            line-height: 1.6;
        }

        .energy-selector {
            margin-bottom: 25px;
        }

        .energy-selector h3 {
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .energy-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .energy-btn {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            color: #666;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .energy-btn:hover {
            background: #FF6B8A;
            color: white;
            border-color: #FF6B8A;
            transform: translateY(-2px);
        }

        .energy-btn.selected {
            background: #FF6B8A;
            color: white;
            border-color: #FF6B8A;
            box-shadow: 0 4px 12px rgba(255, 107, 138, 0.3);
        }

        .calendar-link-btn {
            background: linear-gradient(135deg, #FF6B8A, #FF8C42);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 20px;
        }

        .calendar-link-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 138, 0.3);
        }

        .generate-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .generate-emotional-btn {
            background: linear-gradient(135deg, #FF6B8A, #FFD93D);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 138, 0.3);
        }

        .generate-emotional-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 138, 0.4);
        }

        .generate-emotional-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .emotional-colors-display {
            margin-bottom: 25px;
        }

        .emotional-palette {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .emotional-color {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
        }

        .emotional-color:hover {
            transform: scale(1.1);
        }

        .emotional-color::after {
            content: attr(data-color);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
        }

        .color-interpretation {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
        }

        .save-palette-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .save-palette-btn {
            background: linear-gradient(135deg, #51CF66, #00B894);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(81, 207, 102, 0.3);
        }

        .save-palette-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(81, 207, 102, 0.4);
        }

        .palette-comparison {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .reflection-questions {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #A29BFE, #6C5CE7);
            color: white;
            border-radius: 12px;
        }

        .reflection-questions h3 {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .reflection-questions ul {
            list-style: none;
            padding: 0;
        }

        .reflection-questions li {
            margin-bottom: 12px;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }

        .reflection-questions li::before {
            content: "💭";
            position: absolute;
            left: 0;
            top: 0;
        }

        /* Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: #FF6B8A;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #e55a7a;
            transform: translateY(-1px);
        }

        .current-month {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 8px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            min-height: 300px;
            max-height: 400px;
        }

        .calendar-weekday {
            background: #FF6B8A;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
            border-radius: 8px;
        }

        .calendar-day {
            background: white;
            border: 2px solid #e9ecef;
            padding: 27px 14px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.5em;
            border-radius: 8px;
            transition: all 0.3s;
            min-height: 81px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background: #f8f9fa;
            border-color: #FF6B8A;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 138, 0.2);
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .calendar-day.empty:hover {
            background: transparent;
            border: none;
            transform: none;
            box-shadow: none;
        }

        .calendar-day.today {
            border-color: #FFD93D;
            border-width: 3px;
            box-shadow: 0 0 0 2px rgba(255, 217, 61, 0.3);
        }

        .mood-legend {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #e9ecef;
        }

        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }

            .mood-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .practice-checklists-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="beta-logo" style="width: 120px; height: 120px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; position: relative;">
                <img src="/haven-logo.png" alt="Haven Logo" style="width: 100%; height: 100%; object-fit: contain;">
                <div style="background: #FFD93D; color: #333; padding: 6px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 8px rgba(255, 217, 61, 0.3); position: absolute; top: -10px; right: -10px;">BETA</div>
            </div>
            <h1>Journal</h1>
            <p>Track your emotional wellness journey, capture insights from conversations, and reflect on your growth with Haven.</p>
        </div>

        <!-- ROW 1: Emotional Insights -->
        <div class="section">
            <h2><span class="section-icon"></span>Emotional Insights</h2>
            <div class="insights-grid" id="adding-insights-container">
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="insight-title">Growth Pattern</div>
                    <div class="insight-value" id="adding-growth-pattern">Loading...</div>
                    <div class="insight-description" id="adding-growth-description">Analyzing your additions...</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="insight-title">Strength Discovery</div>
                    <div class="insight-value" id="adding-strength-discovery">Loading...</div>
                    <div class="insight-description" id="adding-strength-description">Discovering your learning strengths...</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="insight-title">Next Growth Edge</div>
                    <div class="insight-value" id="adding-next-growth-edge">Loading...</div>
                    <div class="insight-description" id="adding-next-growth-description">Identifying new opportunities...</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="insight-title">Learning Trend</div>
                    <div class="insight-value" id="adding-learning-trend">Loading...</div>
                    <div class="insight-description" id="adding-learning-trend-description">Analyzing your learning patterns...</div>
                </div>
            </div>
        </div>

        <!-- ROW 2: Today's Mood & Recent Entries (MOVED BELOW) -->

        <!-- ROW 3: Today's Reflection -->
        <div class="section">
            <h2><span class="section-icon">📝</span>Today's Reflection</h2>
            <textarea class="reflection-input" placeholder="How are you feeling today? What insights did you gain from your conversations with Haven? What emotions are you processing?"></textarea>
            <button class="save-btn" onclick="saveJournalEntry()">Save Entry</button>
                        </div>

        <!-- ROW 4: Self-Compassion Practice -->
        <div class="section">
            <h2><span class="section-icon">💝</span>Self-Compassion Practice</h2>
            
            <!-- Badge Recognition Display -->
            <div class="compassion-badge-display" id="compassionBadgeDisplay" style="display: none;">
                <div class="badge-earned-notification">
                    <div class="badge-icon">🏆</div>
                    <div class="badge-content">
                        <div class="badge-title">Self-Compassion Champion</div>
                        <div class="badge-description">You've completed your self-compassion practice!</div>
                </div>
            </div>
        </div>

            <div class="practice-checklists-grid">
                <div class="practice-checklist">
                    <div class="practice-header">
                        <div class="practice-icon">💝</div>
                        <div class="practice-title">Mindful Self-Compassion</div>
                    </div>
                    <div class="practice-description">
                        Practice self-compassion by acknowledging your feelings and treating yourself with kindness.
                    </div>
                    <ul>
                        <li class="checklist-item">
                            <input type="checkbox" id="mindfulSelfCompassion1" class="checklist-checkbox" onchange="updateCompassionProgress()">
                            <label for="mindfulSelfCompassion1" class="checklist-label">Notice negative self-talk and replace with kind words</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="mindfulSelfCompassion2" class="checklist-checkbox" onchange="updateCompassionProgress()">
                            <label for="mindfulSelfCompassion2" class="checklist-label">Practice self-forgiveness for today's mistakes</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="mindfulSelfCompassion3" class="checklist-checkbox" onchange="updateCompassionProgress()">
                            <label for="mindfulSelfCompassion3" class="checklist-label">Write down 3 things you appreciate about yourself</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="mindfulSelfCompassion4" class="checklist-checkbox" onchange="updateCompassionProgress()">
                            <label for="mindfulSelfCompassion4" class="checklist-label">Take a moment to acknowledge your feelings without judgment</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="mindfulSelfCompassion5" class="checklist-checkbox" onchange="updateCompassionProgress()">
                            <label for="mindfulSelfCompassion5" class="checklist-label">Do something kind for yourself today</label>
                        </li>
                    </ul>
                    <div class="practice-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="compassionProgressFill" style="width: 0%;"></div>
                        </div>
                        <div class="progress-text" id="compassionProgressText">0% completed</div>
                    </div>
                </div>
                        </div>
                    </div>

        <!-- ROW 5: Your Emotional Palette -->
        <div class="section">
            <h2><span class="section-icon">🎨</span>Your Emotional Palette</h2>
            <p class="section-subtitle">Transform your feelings into colors and discover what your emotions look like</p>
            
            <div class="enhanced-emotional-palette-container">
                <!-- Color Guide -->
                <div class="color-guide">
                    <h3>Color Guide</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px; font-size: 0.9em;">Click any color to select it</p>
                    <div class="color-guide-grid">
                        <div class="color-guide-item" onclick="selectMoodColor('joyful', '#E8447A', '🩷', 'Joyful')">
                            <div class="color-guide-swatch" style="background: #E8447A; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🩷 Dark Pink = Joyful feelings</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('happy', '#FFD93D', '🟡', 'Happy')">
                            <div class="color-guide-swatch" style="background: #FFD93D; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🟡 Yellow = Happy, optimistic emotions</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('excited', '#FF8C42', '🟠', 'Excited')">
                            <div class="color-guide-swatch" style="background: #FF8C42; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🟠 Orange = Excited, energized states</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('calm', '#87CEEB', '🔵', 'Calm')">
                            <div class="color-guide-swatch" style="background: #87CEEB; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🔵 Light Blue = Calm, peaceful moods</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('neutral', '#D3D3D3', '⚪', 'Neutral')">
                            <div class="color-guide-swatch" style="background: #D3D3D3; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>⚪ Gray = Neutral, balanced feelings</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('sad', '#8B4513', '🟤', 'Sad')">
                            <div class="color-guide-swatch" style="background: #8B4513; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🟤 Brown = Sad, heavy emotions</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('anxious', '#2F4F4F', '🔘', 'Anxious')">
                            <div class="color-guide-swatch" style="background: #2F4F4F; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🔘 Dark Grey-Blue = Anxious, worried energy</span>
                        </div>
                        <div class="color-guide-item" onclick="selectMoodColor('angry', '#FF0000', '🔴', 'Angry')">
                            <div class="color-guide-swatch" style="background: #FF0000; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></div>
                            <span>🔴 Red = Angry, intense feelings</span>
                        </div>
                    </div>
                </div>

                <!-- Process -->
                <div class="enhanced-emotional-process">
                    <div class="process-explanation">
                        <p>Sometimes we feel emotions we can't name. Colors help your subconscious speak when words aren't enough. Your emotional palette is like a mood ring for your inner world.</p>
                    </div>

                    <!-- Step 1: Color Selection -->
                    <div class="mood-input-section">
                        <label class="mood-input-label">Step 1: Click any mood color above</label>
                        <div id="selectedMoodDisplay" style="text-align: center; color: #666; font-size: 0.9em; margin-top: 10px;">No mood selected yet</div>
                    </div>

                    <!-- Step 2: Intensity Selection -->
                    <div class="intensity-section">
                        <label class="intensity-label">Step 2: Choose intensity level</label>
                        <div class="intensity-buttons">
                            <button class="intensity-btn" onclick="selectIntensity(1)">1 - Subtle</button>
                            <button class="intensity-btn" onclick="selectIntensity(2)">2 - Light</button>
                            <button class="intensity-btn" onclick="selectIntensity(3)">3 - Medium</button>
                            <button class="intensity-btn" onclick="selectIntensity(4)">4 - Strong</button>
                            <button class="intensity-btn" onclick="selectIntensity(5)">5 - Intense</button>
                        </div>
                        <div id="selectedIntensityDisplay" style="text-align: center; color: #666; font-size: 0.9em; margin-top: 10px;">No intensity selected</div>
                    </div>

                    <!-- Step 3: Add to Calendar Button -->
                    <div class="calendar-link-section">
                        <button id="addToCalendarBtn" class="calendar-link-btn" onclick="addToCalendar()" disabled>
                            📅 Add to Calendar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 5.5: Today's Mood & Recent Entries (MOVED HERE) -->
        <div class="section">
            <h2><span class="section-icon">😊</span>Today's Mood & Recent Entries</h2>
            <div class="mood-grid">
                <div class="mood-item" onclick="selectMoodAndLinkToCalendar('excited', this)">
                    <div class="mood-icon">😊</div>
                    <div class="mood-label">Happy</div>
                        </div>
                <div class="mood-item" onclick="selectMoodAndLinkToCalendar('calm', this)">
                    <div class="mood-icon">😌</div>
                    <div class="mood-label">Calm</div>
                    </div>
                <div class="mood-item" onclick="selectMoodAndLinkToCalendar('neutral', this)">
                    <div class="mood-icon">😐</div>
                    <div class="mood-label">Neutral</div>
                    </div>
                <div class="mood-item" onclick="selectMoodAndLinkToCalendar('anxious', this)">
                    <div class="mood-icon">😰</div>
                    <div class="mood-label">Anxious</div>
                        </div>
                <div class="mood-item" onclick="selectMoodAndLinkToCalendar('sad', this)">
                    <div class="mood-icon">😔</div>
                    <div class="mood-label">Sad</div>
                        </div>
                        </div>
            <div class="entry-filters">
                <button class="filter-btn active" onclick="filterEntries('all')">All</button>
                <button class="filter-btn" onclick="filterEntries('happy')">Happy</button>
                <button class="filter-btn" onclick="filterEntries('calm')">Calm</button>
                <button class="filter-btn" onclick="filterEntries('anxious')">Anxious</button>
                <button class="filter-btn" onclick="filterEntries('sad')">Sad</button>
                        </div>
            <div id="entriesList">
                <!-- Recent entries will be loaded here -->
                    </div>
                </div>




    </div>

        <!-- ROW 7: Simple Calendar -->
        <div class="section">
            <h2><span class="section-icon">📆</span>Simple Calendar</h2>
            <div id="simple-calendar-container">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="previousMonthSimple()">‹</button>
                        <div class="current-month" id="current-month-simple">August 2025</div>
                        <button class="nav-btn" onclick="nextMonthSimple()">›</button>
                    </div>
                </div>
                <div class="calendar-grid" id="simple-calendar-grid">
                    <!-- Calendar will be populated by JavaScript -->
                </div>

            </div>
            <div class="mood-legend" style="margin-top: 200px;">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #E8447A;"></div>
                    <span>Joyful</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FF9A8B;"></div>
                    <span>Happy</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FFD93D;"></div>
                    <span>Excited</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #87CEEB;"></div>
                    <span>Calm</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #D3D3D3;"></div>
                    <span>Neutral</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #8B4513;"></div>
                    <span>Sad</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2F4F4F;"></div>
                    <span>Anxious</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FF0000;"></div>
                    <span>Angry</span>
                </div>
            </div>
            </div>
        </div>

        <!-- GRATITUDE GLOW-UP SECTION -->
        <div class="section">
            <h2><span class="section-icon">✨</span>Gratitude Glow-Up</h2>
            <p>Your daily dose of good vibes and appreciation ✨</p>
            
            <!-- GRATITUDE GENERATOR -->
            <div style="margin-top: 30px;">
                <h3 style="color: #FF6B8A; margin-bottom: 20px; text-align: center;">✨ Gratitude Generator</h3>
                <p style="text-align: center; margin-bottom: 25px; color: #636e72; font-style: italic;">What's sparking joy in your world today?</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.4s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">🌅</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">Morning Magic</div>
                        <p style="font-size: 14px; margin-bottom: 15px; color: #636e72;">What made this morning special?</p>
                        <input type="text" placeholder="First sip of coffee, sunrise vibes, cozy bed..." style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 15px; font-size: 14px; margin-top: 10px; transition: all 0.3s ease; background: #f8f9fa;">
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.4s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">💝</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">People Power</div>
                        <p style="font-size: 14px; margin-bottom: 15px; color: #636e72;">Who brought good energy today?</p>
                        <input type="text" placeholder="Sweet text from bestie, random compliment, hug from mom..." style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 15px; font-size: 14px; margin-top: 10px; transition: all 0.3s ease; background: #f8f9fa;">
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.4s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">🎯</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">Personal Wins</div>
                        <p style="font-size: 14px; margin-bottom: 15px; color: #636e72;">What are you proud of today?</p>
                        <input type="text" placeholder="Finished that task, tried something new, chose self-care..." style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 15px; font-size: 14px; margin-top: 10px; transition: all 0.3s ease; background: #f8f9fa;">
                    </div>
                </div>
            </div>

            <!-- MOOD ENERGY TRACKER -->
            <div style="margin-top: 40px;">
                <h3 style="color: #FF6B8A; margin-bottom: 20px; text-align: center;">⚡ Mood Energy Check</h3>
                <p style="text-align: center; margin-bottom: 25px; color: #636e72; font-style: italic;">How are you feeling right now? Let's vibe check! 💯</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; border: 2px solid #e9ecef; transition: all 0.3s ease;">
                        <div style="font-weight: bold; margin-bottom: 20px; color: #FF6B8A; font-size: 18px; text-align: center;">Today's Vibe</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div class="mood-option" data-mood="amazing" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">🤩 Amazing</div>
                            <div class="mood-option" data-mood="good" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">😊 Good</div>
                            <div class="mood-option" data-mood="okay" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">😌 Okay</div>
                            <div class="mood-option" data-mood="meh" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">😐 Meh</div>
                            <div class="mood-option" data-mood="rough" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">😔 Rough</div>
                            <div class="mood-option" data-mood="struggling" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">😰 Struggling</div>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; border: 2px solid #e9ecef; transition: all 0.3s ease;">
                        <div style="font-weight: bold; margin-bottom: 20px; color: #FF6B8A; font-size: 18px; text-align: center;">Energy Level</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div class="energy-option" data-energy="high" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">🔥 High</div>
                            <div class="energy-option" data-energy="medium" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">⚡ Medium</div>
                            <div class="energy-option" data-energy="low" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">💤 Low</div>
                            <div class="energy-option" data-energy="drained" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">🪫 Drained</div>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; border: 2px solid #e9ecef; transition: all 0.3s ease;">
                        <div style="font-weight: bold; margin-bottom: 20px; color: #FF6B8A; font-size: 18px; text-align: center;">Gratitude Power</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div class="gratitude-option" data-gratitude="overflowing" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">🌟 Overflowing</div>
                            <div class="gratitude-option" data-gratitude="present" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">✨ Present</div>
                            <div class="gratitude-option" data-gratitude="searching" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">🔍 Searching</div>
                            <div class="gratitude-option" data-gratitude="blocked" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px 10px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid #e9ecef; font-size: 14px; font-weight: 500;">🚧 Blocked</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- APPRECIATION STATION -->
            <div style="margin-top: 40px;">
                <h3 style="color: #FF6B8A; margin-bottom: 20px; text-align: center;">💖 Appreciation Station</h3>
                <p style="text-align: center; margin-bottom: 25px; color: #636e72; font-style: italic;">Let's get specific about what's working in your life!</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">🏠</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">Home & Comfort</div>
                        <textarea placeholder="Grateful for my cozy space, warm shower, good wifi..." style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 20px; font-size: 16px; min-height: 120px; resize: vertical; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); color: #2d3436; font-family: inherit; line-height: 1.6; transition: all 0.3s ease;"></textarea>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">💪</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">Body & Health</div>
                        <textarea placeholder="My body carried me through the day, feeling strong..." style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 20px; font-size: 16px; min-height: 120px; resize: vertical; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); color: #2d3436; font-family: inherit; line-height: 1.6; transition: all 0.3s ease;"></textarea>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">🎨</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">Opportunities & Growth</div>
                        <textarea placeholder="Learned something new, got to try this, chance to..." style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 20px; font-size: 16px; min-height: 120px; resize: vertical; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); color: #2d3436; font-family: inherit; line-height: 1.6; transition: all 0.3s ease;"></textarea>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid #e9ecef; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <span style="font-size: 40px; margin-bottom: 15px; display: block;">🌍</span>
                        <div style="font-weight: bold; margin-bottom: 15px; color: #FF6B8A; font-size: 18px;">World Around Me</div>
                        <textarea placeholder="Beautiful sunset, kind stranger, this song, nature..." style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 20px; font-size: 16px; min-height: 120px; resize: vertical; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); color: #2d3436; font-family: inherit; line-height: 1.6; transition: all 0.3s ease;"></textarea>
                    </div>
                </div>
            </div>

            <!-- GLOW UP PRACTICES -->
            <div style="margin-top: 40px; background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 50%, #FF9A8B 100%); color: white; border-radius: 25px; padding: 35px;">
                <h3 style="margin-bottom: 20px; text-align: center; font-size: 28px;">🌟 Daily Glow-Up Practices</h3>
                <p style="text-align: center; margin-bottom: 25px; font-style: italic;">Small actions, big energy shifts! ✨</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div onclick="togglePractice(this)" style="background: rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 20px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer;">
                        <span style="font-size: 32px; margin-bottom: 15px; display: block;">📱</span>
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Gratitude Story</div>
                        <p style="font-size: 14px; margin-bottom: 10px;">Share good vibes with someone</p>
                        <button class="practice-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 12px 24px; border-radius: 25px; cursor: pointer; margin-top: 15px; transition: all 0.3s ease; font-weight: bold; backdrop-filter: blur(5px);">Complete</button>
                    </div>
                    
                    <div onclick="togglePractice(this)" style="background: rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 20px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer;">
                        <span style="font-size: 32px; margin-bottom: 15px; display: block;">🪞</span>
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Mirror Appreciation</div>
                        <p style="font-size: 14px; margin-bottom: 10px;">Give yourself a genuine compliment</p>
                        <button class="practice-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 12px 24px; border-radius: 25px; cursor: pointer; margin-top: 15px; transition: all 0.3s ease; font-weight: bold; backdrop-filter: blur(5px);">Complete</button>
                    </div>
                    
                    <div onclick="togglePractice(this)" style="background: rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 20px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer;">
                        <span style="font-size: 32px; margin-bottom: 15px; display: block;">📸</span>
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Moment Capture</div>
                        <p style="font-size: 14px; margin-bottom: 10px;">Photo or mental snapshot of something beautiful</p>
                        <button class="practice-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 12px 24px; border-radius: 25px; cursor: pointer; margin-top: 15px; transition: all 0.3s ease; font-weight: bold; backdrop-filter: blur(5px);">Complete</button>
                    </div>
                    
                    <div onclick="togglePractice(this)" style="background: rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 20px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer;">
                        <span style="font-size: 32px; margin-bottom: 15px; display: block;">🎵</span>
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Grateful Playlist</div>
                        <p style="font-size: 14px; margin-bottom: 10px;">Listen to a song that lifts your spirit</p>
                        <button class="practice-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 12px 24px; border-radius: 25px; cursor: pointer; margin-top: 15px; transition: all 0.3s ease; font-weight: bold; backdrop-filter: blur(5px);">Complete</button>
                    </div>
                    
                    <div onclick="togglePractice(this)" style="background: rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 20px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer;">
                        <span style="font-size: 32px; margin-bottom: 15px; display: block;">✍️</span>
                        <div style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Thank You Note</div>
                        <p style="font-size: 14px; margin-bottom: 10px;">Write gratitude to someone (send optional)</p>
                        <button class="practice-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 12px 24px; border-radius: 25px; cursor: pointer; margin-top: 15px; transition: all 0.3s ease; font-weight: bold; backdrop-filter: blur(5px);">Complete</button>
                    </div>
                </div>
            </div>

            <!-- SAVE BUTTON -->
            <div style="text-align: center; margin-top: 40px;">
                <button onclick="saveGratitudeJournal()" style="background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%); color: white; border: none; padding: 20px 50px; border-radius: 35px; font-size: 20px; font-weight: bold; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 10px 30px rgba(255, 107, 138, 0.3); text-transform: uppercase; letter-spacing: 1px; margin-right: 10px;">Save Gratitude Journal</button>
                <button onclick="shareJournalEntry()" style="background: linear-gradient(135deg, #FF8C42 0%, #FFD93D 100%); color: white; border: none; padding: 20px 50px; border-radius: 35px; font-size: 20px; font-weight: bold; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 10px 30px rgba(255, 140, 66, 0.3); text-transform: uppercase; letter-spacing: 1px; margin-right: 10px;">Share Journal ✨</button>
                <a href="saved-journals.html" style="background: linear-gradient(135deg, #FF9A8B 0%, #FFD93D 100%); color: white; border: none; padding: 20px 50px; border-radius: 35px; font-size: 20px; font-weight: bold; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 10px 30px rgba(255, 154, 139, 0.3); text-transform: uppercase; letter-spacing: 1px; text-decoration: none; display: inline-block;">View Saved Journals</a>
            </div>
        </div>

    <!-- Plan Upgrade Overlay -->
    <div class="plan-upgrade-overlay" id="planUpgradeOverlay" style="display: none;">
        <div class="upgrade-modal">
            <div class="upgrade-icon">📝</div>
            <div class="upgrade-title">Journal Feature</div>
            <div class="upgrade-message">
                The Journal feature is available for Regular ($9.99+) plan users. 
                Upgrade your plan to start tracking your emotional journey and reflections.
            </div>
            <button class="upgrade-button" onclick="upgradeToRegular()">Upgrade to Regular Plan</button>
            
            <!-- Promo Code Section -->
            <div class="promo-code-section" style="margin-top: 20px; text-align: center;">
                <div style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Or enter a promo code:</div>
                <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                    <input type="text" id="promoCodeInput" placeholder="Enter code..." 
                           style="padding: 8px 12px; border: 2px solid #FFD93D; border-radius: 8px; font-size: 14px; width: 120px; text-align: center; text-transform: uppercase;">
                    <button class="upgrade-button" onclick="applyPromoCodeFromInput()" 
                            style="background: #FFD93D; color: #333; padding: 8px 16px; font-size: 14px;">Apply</button>
                </div>
            </div>
        </div>
    </div>

            <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-items">
            <a href="home.html" class="nav-item">
                <div class="nav-icon"></div>
                <div class="nav-label">Home</div>
            </a>
            <a href="index.html" class="nav-item">
                <div class="nav-icon"></div>
                <div class="nav-label">Chat</div>
            </a>
            <a href="journal.html" class="nav-item active">
                <div class="nav-icon"></div>
                <div class="nav-label">Journal</div>
            </a>
            <a href="badges.html" class="nav-item">
                <div class="nav-icon"></div>
                <div class="nav-label">Badges</div>
            </a>
            <a href="plans.html" class="nav-item">
                <div class="nav-icon"></div>
                <div class="nav-label">Plans</div>
            </a>
            <a href="account.html" class="nav-item">
                <div class="nav-icon"></div>
                <div class="nav-label">Account</div>
            </a>
            <a href="support.html" class="nav-item">
                <div class="nav-icon"></div>
                <div class="nav-label">Support</div>
            </a>
                    </div>
            <!-- Footer Banner -->
            <div class="footer-banner">
                <div class="footer-text">
                    <div>Haven is an educational platform. Not medical advice.</div>
                    <div>Crisis support: 988</div>
                </div>
            </div>
        </nav>

    <script>
        // Test function to verify script is loading
        console.log('Script loading...');
        
        // Make functions globally available
        window.renderSimpleCalendar = function() {
            const grid = document.getElementById('simple-calendar-grid');
            if (!grid) {
                alert('Calendar grid not found!');
                return;
            }
            
            // Clear the grid
            grid.innerHTML = '';
            
            // Get current month info
            const firstDay = new Date(currentYearSimple, currentMonthSimple, 1);
            const lastDay = new Date(currentYearSimple, currentMonthSimple + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Update month display
            const monthDisplay = document.getElementById('current-month-simple');
            if (monthDisplay) {
                monthDisplay.textContent = monthNames[currentMonthSimple] + ' ' + currentYearSimple;
            }
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-weekday';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                grid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Check if today
                const today = new Date();
                if (day === today.getDate() && currentMonthSimple === today.getMonth() && currentYearSimple === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Add click handler
                dayElement.onclick = function() {
                    alert('You clicked on day ' + day + '! 📅');
                };
                
                grid.appendChild(dayElement);
            }
        };
        
        window.testMoodSystem = function() {
            // Add a test mood to today's date
            const today = new Date();
            const dateString = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
            
            const testMood = {
                mood: 'sad',
                intensity: 4,
                color: '#8d6e63',
                emoji: '🟤',
                label: 'Sad'
            };
            
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            moodData[dateString] = testMood;
            localStorage.setItem('haven_mood_calendar', JSON.stringify(moodData));
            
            alert('Test mood saved! Date: ' + dateString);
            window.renderSimpleCalendar();
        };
        
        window.previousMonthSimple = function() {
            currentMonthSimple--;
            if (currentMonthSimple < 0) {
                currentMonthSimple = 11;
                currentYearSimple--;
            }
            window.renderSimpleCalendar();
        };
        
        window.nextMonthSimple = function() {
            currentMonthSimple++;
            if (currentMonthSimple > 11) {
                currentMonthSimple = 0;
                currentYearSimple++;
            }
            window.renderSimpleCalendar();
        };
        
        // Gratitude Journal Functions
        window.togglePractice = function(element) {
            const button = element.querySelector('.practice-btn');
            const wasCompleted = button.textContent === 'Completed!';
            
            if (button.textContent === 'Complete') {
                button.textContent = 'Completed!';
                button.style.background = '#FFD93D';
                button.style.color = '#2d3436';
                button.style.borderColor = '#FFD93D';
                element.style.transform = 'scale(1.02)';
                
                // Badge tracking for practice completion
                if (typeof trackPracticeBadge === 'function') {
                    // Determine practice type based on button text or parent content
                    const practiceText = element.textContent.toLowerCase();
                    let practiceType = 'general';
                    
                    if (practiceText.includes('mindfulness') || practiceText.includes('meditation')) {
                        practiceType = 'mindfulness';
                    } else if (practiceText.includes('boundary') || practiceText.includes('limit')) {
                        practiceType = 'boundary-setting';
                    } else if (practiceText.includes('comfort') || practiceText.includes('zone')) {
                        practiceType = 'comfort-zone';
                    } else if (practiceText.includes('crisis') || practiceText.includes('support')) {
                        practiceType = 'crisis-support';
                    }
                    
                    trackPracticeBadge(practiceType);
                }
            } else {
                button.textContent = 'Complete';
                button.style.background = 'rgba(255, 255, 255, 0.2)';
                button.style.color = 'white';
                button.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                element.style.transform = 'scale(1)';
            }
        };
        
        window.saveGratitudeJournal = function() {
            console.log('saveGratitudeJournal called!');
            
            // Collect all the gratitude data
            const gratitudeData = {
                date: new Date().toISOString(),
                morningMagic: document.querySelector('input[placeholder*="coffee"]')?.value || '',
                peoplePower: document.querySelector('input[placeholder*="bestie"]')?.value || '',
                personalWins: document.querySelector('input[placeholder*="task"]')?.value || '',
                homeComfort: document.querySelector('textarea[placeholder*="cozy"]')?.value || '',
                bodyHealth: document.querySelector('textarea[placeholder*="body"]')?.value || '',
                opportunitiesGrowth: document.querySelector('textarea[placeholder*="Learned"]')?.value || '',
                worldAroundMe: document.querySelector('textarea[placeholder*="Beautiful"]')?.value || '',
                selectedMood: document.querySelector('.mood-option.selected')?.dataset.mood || '',
                selectedEnergy: document.querySelector('.energy-option.selected')?.dataset.energy || '',
                selectedGratitude: document.querySelector('.gratitude-option.selected')?.dataset.gratitude || '',
                completedPractices: Array.from(document.querySelectorAll('.practice-btn')).filter(btn => btn.textContent === 'Completed!').length
            };
            
            // Check if any mood/energy/gratitude options are selected
            const hasMoodSelection = document.querySelector('.mood-option.selected');
            const hasEnergySelection = document.querySelector('.energy-option.selected');
            const hasGratitudeSelection = document.querySelector('.gratitude-option.selected');
            
            console.log('Mood selection:', hasMoodSelection);
            console.log('Energy selection:', hasEnergySelection);
            console.log('Gratitude selection:', hasGratitudeSelection);
            
            if (!hasMoodSelection || !hasEnergySelection || !hasGratitudeSelection) {
                alert('Please select your mood, energy level, and gratitude power before saving! 🌟');
                return;
            }
            
            // Save to localStorage
            const savedJournals = JSON.parse(localStorage.getItem('haven_gratitude_journals') || '[]');
            savedJournals.push(gratitudeData);
            localStorage.setItem('haven_gratitude_journals', JSON.stringify(savedJournals));
            
            // Badge tracking for gratitude journal completion
            if (typeof trackJournalBadge === 'function') {
                trackJournalBadge('daily_gratitude');
            }
            
            // Track Morning Gratitude badge (daily)
            if (typeof updateBadgeProgress === 'function') {
                updateBadgeProgress('morning-gratitude', 1);
            }
            
            // Check if all appreciation sections are completed
            const allSectionsFilled = gratitudeData.morningMagic && gratitudeData.peoplePower && 
                                    gratitudeData.personalWins && gratitudeData.homeComfort && 
                                    gratitudeData.bodyHealth && gratitudeData.opportunitiesGrowth && 
                                    gratitudeData.worldAroundMe;
            
            if (allSectionsFilled && typeof trackJournalBadge === 'function') {
                trackJournalBadge('appreciation_master');
            }
            
            // Check if mood & energy are selected
            if (hasMoodSelection && hasEnergySelection && typeof trackJournalBadge === 'function') {
                trackJournalBadge('mood_tracker');
            }
            
            // Track Mood Master badge (daily)
            if (hasMoodSelection && typeof updateBadgeProgress === 'function') {
                updateBadgeProgress('mood-master', 1);
            }
            
            // Check if all 6 daily practices are completed
            if (gratitudeData.completedPractices >= 6 && typeof trackPracticeBadge === 'function') {
                trackPracticeBadge('glow_up_guru');
            }
            
            // Track Daily Zen badge (daily)
            if (gratitudeData.completedPractices >= 6 && typeof updateBadgeProgress === 'function') {
                updateBadgeProgress('daily-zen', 6);
            }
            
            // Track weekly journal enthusiast badge (3 journal entries per week)
            if (typeof window.badgeTracker !== 'undefined' && window.badgeTracker.getWeekKey) {
                const weeklyJournals = JSON.parse(localStorage.getItem('haven_weekly_journals') || '{}');
                const currentWeek = window.badgeTracker.getWeekKey();
                weeklyJournals[currentWeek] = (weeklyJournals[currentWeek] || 0) + 1;
                localStorage.setItem('haven_weekly_journals', JSON.stringify(weeklyJournals));
                
                if (weeklyJournals[currentWeek] <= 3) {
                    updateBadgeProgress('journal-enthusiast', weeklyJournals[currentWeek]);
                }
            }
            
            // Track weekly activities for growth sprinter badge
            if (typeof trackWeeklyActivity === 'function') {
                trackWeeklyActivity('gratitude_journal');
                
                // Track additional activities based on what was completed
                if (gratitudeData.completedPractices >= 6) {
                    trackWeeklyActivity('daily_practices');
                }
                if (hasMoodSelection) {
                    trackWeeklyActivity('mood_tracking');
                }
                if (allSectionsFilled) {
                    trackWeeklyActivity('complete_journal');
                }
            }
            
            // Track comfort zone activities for comfort zone crusher badge
            if (typeof trackComfortZoneActivity === 'function') {
                // Track when user shares their journal (stepping outside comfort zone)
                if (allSectionsFilled) {
                    trackComfortZoneActivity('share_journal');
                }
                // Track when user practices self-compassion (can be uncomfortable)
                if (gratitudeData.selectedGratitude && gratitudeData.selectedGratitude.includes('self')) {
                    trackComfortZoneActivity('self_compassion');
                }
            }
            
            // Track monthly badges
            if (typeof trackMonthlyActivity === 'function') {
                // Track monthly champion (20 days this month)
                trackMonthlyActivity('daily_activity');
                
                // Track gratitude master (15 journal entries this month)
                trackMonthlyActivity('gratitude_journal');
                
                // Track wellness warrior (25 wellness activities this month)
                trackMonthlyActivity('wellness_activity');
            }
            
            // Show success message
            alert('✨ Your gratitude journal has been saved! Keep spreading those good vibes! 🌟');
        };
        
        window.viewSavedJournals = function() {
            const savedJournals = JSON.parse(localStorage.getItem('haven_gratitude_journals') || '[]');
            
            if (savedJournals.length === 0) {
                alert('No saved gratitude journals found. Save your first one! ✨');
                return;
            }
            
            let message = '📖 Your Saved Gratitude Journals:\n\n';
            
            savedJournals.forEach((journal, index) => {
                const date = new Date(journal.date).toLocaleDateString();
                message += `📅 ${date}\n`;
                message += `🌅 Morning Magic: ${journal.morningMagic || 'Not filled'}\n`;
                message += `💝 People Power: ${journal.peoplePower || 'Not filled'}\n`;
                message += `🎯 Personal Wins: ${journal.personalWins || 'Not filled'}\n`;
                message += `🏠 Home & Comfort: ${journal.homeComfort || 'Not filled'}\n`;
                message += `💪 Body & Health: ${journal.bodyHealth || 'Not filled'}\n`;
                message += `🎨 Opportunities & Growth: ${journal.opportunitiesGrowth || 'Not filled'}\n`;
                message += `🌍 World Around Me: ${journal.worldAroundMe || 'Not filled'}\n`;
                message += `😊 Mood: ${journal.selectedMood || 'Not selected'}\n`;
                message += `⚡ Energy: ${journal.selectedEnergy || 'Not selected'}\n`;
                message += `✨ Gratitude Power: ${journal.selectedGratitude || 'Not selected'}\n`;
                message += `✅ Completed Practices: ${journal.completedPractices}/5\n`;
                message += `\n${'─'.repeat(50)}\n\n`;
            });
            
            alert(message);
        };
        
        console.log('Script is loading...');
        
        // Add click handlers for mood/energy/gratitude options using event delegation
        document.addEventListener('click', function(event) {
            console.log('Click detected on:', event.target.className);
            
            // Handle mood options
            if (event.target.classList.contains('mood-option')) {
                console.log('Mood option clicked:', event.target.dataset.mood);
                // Reset all mood options
                document.querySelectorAll('.mood-option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%)';
                    opt.style.color = '#2d3436';
                    opt.style.transform = 'scale(1)';
                    opt.style.borderColor = '#e9ecef';
                    opt.style.boxShadow = 'none';
                });
                
                // Highlight selected option
                event.target.classList.add('selected');
                event.target.style.background = 'linear-gradient(135deg, #FF8C42 0%, #FFD93D 100%)';
                event.target.style.color = 'white';
                event.target.style.transform = 'scale(1.05) translateY(-5px)';
                event.target.style.borderColor = '#FF8C42';
                event.target.style.boxShadow = '0 10px 25px rgba(255, 140, 66, 0.3)';
            }
            
            // Handle energy options
            if (event.target.classList.contains('energy-option')) {
                // Reset all energy options
                document.querySelectorAll('.energy-option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%)';
                    opt.style.color = '#2d3436';
                    opt.style.transform = 'scale(1)';
                    opt.style.borderColor = '#e9ecef';
                    opt.style.boxShadow = 'none';
                });
                
                // Highlight selected option
                event.target.classList.add('selected');
                event.target.style.background = 'linear-gradient(135deg, #FF8C42 0%, #FFD93D 100%)';
                event.target.style.color = 'white';
                event.target.style.transform = 'scale(1.05) translateY(-5px)';
                event.target.style.borderColor = '#FF8C42';
                event.target.style.boxShadow = '0 10px 25px rgba(255, 140, 66, 0.3)';
            }
            
            // Handle gratitude options
            if (event.target.classList.contains('gratitude-option')) {
                // Reset all gratitude options
                document.querySelectorAll('.gratitude-option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%)';
                    opt.style.color = '#2d3436';
                    opt.style.transform = 'scale(1)';
                    opt.style.borderColor = '#e9ecef';
                    opt.style.boxShadow = 'none';
                });
                
                // Highlight selected option
                event.target.classList.add('selected');
                event.target.style.background = 'linear-gradient(135deg, #FF8C42 0%, #FFD93D 100%)';
                event.target.style.color = 'white';
                event.target.style.transform = 'scale(1.05) translateY(-5px)';
                event.target.style.borderColor = '#FF8C42';
                event.target.style.boxShadow = '0 10px 25px rgba(255, 140, 66, 0.3)';
            }
        });
        
        // Simple working functions
        function simpleRenderCalendar() {
            alert('Calendar render function called!');
            const grid = document.getElementById('simple-calendar-grid');
            if (!grid) {
                alert('Calendar grid not found!');
                return;
            }
            
            // Clear and add basic calendar
            grid.innerHTML = '';
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-weekday';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Add some test days
            for (let day = 1; day <= 31; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                grid.appendChild(dayElement);
            }
            
            alert('Calendar rendered!');
        }

        function simpleTestMood() {
            alert('Test mood function called!');
            const today = new Date();
            const dateString = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
            
            const testMood = {
                mood: 'sad',
                intensity: 4,
                color: '#8d6e63',
                emoji: '🟤',
                label: 'Sad'
            };
            
            localStorage.setItem('haven_mood_calendar', JSON.stringify({[dateString]: testMood}));
            alert('Test mood saved! Date: ' + dateString);
        }
        
        // Global variables for simple calendar
        let currentMonthSimple = new Date().getMonth();
        let currentYearSimple = new Date().getFullYear();

        // Global variables for emotional palette
        let selectedMoodColor = null;
        let selectedMoodName = null;
        let selectedMoodEmoji = null;
        let selectedMoodLabel = null;
        let selectedIntensityLevel = null;

        // Global functions for emotional palette - must be defined first
        function selectMoodColor(moodName, color, emoji, label) {
            selectedMoodName = moodName;
            selectedMoodEmoji = emoji;
            selectedMoodLabel = label;
            selectedMoodColor = color; // Set the base color
            
            // Update display
            document.getElementById('selectedMoodDisplay').textContent = emoji + ' ' + label + ' selected';
            document.getElementById('selectedMoodDisplay').style.color = '#FF6B8A';
            
            // Enable intensity buttons if not already selected
            if (selectedIntensityLevel) {
                enableAddToCalendarButton();
            }
        }

        function getMoodColorWithIntensity(moodName, intensity) {
            // 40-color palette with intensity levels
            const moodColorPalette = {
                'joyful': {
                    1: '#FFB3C7', // Subtle pink
                    2: '#FF8FA3', // Light pink  
                    3: '#FF6B8A', // Medium pink
                    4: '#E8447A', // Strong pink
                    5: '#D63384'  // Intense pink
                },
                'happy': {
                    1: '#FFF2CC', // Subtle yellow
                    2: '#FFE066', // Light yellow
                    3: '#FFD93D', // Medium yellow
                    4: '#FFC107', // Strong yellow
                    5: '#FFB300'  // Intense yellow
                },
                'excited': {
                    1: '#FFD4B3', // Subtle orange
                    2: '#FFB366', // Light orange
                    3: '#FF8C42', // Medium orange
                    4: '#FF6B35', // Strong orange
                    5: '#FF5722'  // Intense orange
                },
                'calm': {
                    1: '#E3F2FD', // Subtle blue
                    2: '#BBDEFB', // Light blue
                    3: '#87CEEB', // Medium blue
                    4: '#42A5F5', // Strong blue
                    5: '#2196F3'  // Intense blue
                },
                'neutral': {
                    1: '#F5F5F5', // Subtle gray
                    2: '#E0E0E0', // Light gray
                    3: '#D3D3D3', // Medium gray
                    4: '#BDBDBD', // Strong gray
                    5: '#9E9E9E'  // Intense gray
                },
                'sad': {
                    1: '#D7CCC8', // Subtle brown
                    2: '#BCAAA4', // Light brown
                    3: '#8B4513', // Medium brown
                    4: '#6D4C41', // Strong brown
                    5: '#4E342E'  // Intense brown
                },
                'anxious': {
                    1: '#E0F2F1', // Subtle teal
                    2: '#B2DFDB', // Light teal
                    3: '#2F4F4F', // Medium teal
                    4: '#00695C', // Strong teal
                    5: '#004D40'  // Intense teal
                },
                'angry': {
                    1: '#FFCDD2', // Subtle red
                    2: '#EF9A9A', // Light red
                    3: '#FF0000', // Medium red
                    4: '#D32F2F', // Strong red
                    5: '#B71C1C'  // Intense red
                }
            };
            
            // Get the color for this mood and intensity
            const moodColors = moodColorPalette[moodName];
            if (moodColors && moodColors[intensity]) {
                return moodColors[intensity];
            }
            
            // Fallback to base color if not found
            const baseColors = {
                'joyful': '#E8447A',
                'happy': '#FFD93D', 
                'excited': '#FF8C42',
                'calm': '#87CEEB',
                'neutral': '#D3D3D3',
                'sad': '#8B4513',
                'anxious': '#2F4F4F',
                'angry': '#FF0000'
            };
            
            return baseColors[moodName] || '#D3D3D3';
        }
        
        function selectIntensity(level) {
            selectedIntensityLevel = level;
            
            // Remove selected class from all intensity buttons
            document.querySelectorAll('.intensity-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to clicked button
            event.target.classList.add('selected');
            
            // Update display
            const intensityLabels = ['Subtle', 'Light', 'Medium', 'Strong', 'Intense'];
            document.getElementById('selectedIntensityDisplay').textContent = 'Level ' + level + ' - ' + intensityLabels[level-1] + ' selected';
            document.getElementById('selectedIntensityDisplay').style.color = '#FF6B8A';
            
            // Get the color for this mood and intensity
            if (selectedMoodName) {
                selectedMoodColor = getMoodColorWithIntensity(selectedMoodName, level);
            }
            
            // Enable add to calendar button if mood is selected
            if (selectedMoodName) {
                enableAddToCalendarButton();
            }
        }

        function enableAddToCalendarButton() {
            const addBtn = document.getElementById('addToCalendarBtn');
            addBtn.disabled = false;
            addBtn.style.opacity = '1';
            addBtn.style.cursor = 'pointer';
        }

        function testMoodSystem() {
            alert('testMoodSystem called!');
            // Add a test mood to today's date
            const today = new Date();
            const dateString = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
            
            const testMood = {
                mood: 'sad',
                intensity: 4,
                color: '#8d6e63',
                emoji: '🟤',
                label: 'Sad'
            };
            
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            moodData[dateString] = testMood;
            localStorage.setItem('haven_mood_calendar', JSON.stringify(moodData));
            
            alert('Test mood saved! Date: ' + dateString);
            renderSimpleCalendar();
        }

        function addToCalendar() {
            if (!selectedMoodColor || !selectedIntensityLevel) {
                alert('Please select both a mood color and intensity level first.');
                return;
            }

            // Get today's date
            const today = new Date();
            const dateString = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
            
            // Save to localStorage
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            moodData[dateString] = { 
                mood: selectedMoodName, 
                intensity: selectedIntensityLevel,
                color: selectedMoodColor,
                emoji: selectedMoodEmoji,
                label: selectedMoodLabel
            };
            localStorage.setItem('haven_mood_calendar', JSON.stringify(moodData));
            
            // Update both calendars
            createCalendar();
            renderSimpleCalendar();
            
            // Apply color to today in Simple Calendar
            const todayDay = today.getDate();
            const dayElements = document.querySelectorAll('#simple-calendar-grid .calendar-day');
            for(let i = 0; i < dayElements.length; i++) {
                // Check if this is today's day (with or without emoji)
                const dayText = dayElements[i].textContent.trim();
                const dayNumber = dayText.replace(/[😊😌😐😰😔]/g, '').trim();
                
                if(dayNumber === todayDay.toString()) {
                    const intensityColor = getMoodColorWithIntensity(selectedMoodName, selectedIntensityLevel);
                    
                    // Store existing emoji BEFORE applying any changes
                    const existingEmoji = (() => {
                        const emojiMatch = dayText.match(/[😊😌😐😰😔]/);
                        return emojiMatch ? emojiMatch[0] : null;
                    })();
                    
                    // Apply color styling
                    dayElements[i].style.background = intensityColor;
                    dayElements[i].style.color = 'white';
                    dayElements[i].style.fontWeight = 'bold';
                    
                    // Restore emoji if it existed
                    if (existingEmoji) {
                        dayElements[i].innerHTML = todayDay + ' ' + existingEmoji;
                    } else {
                        dayElements[i].innerHTML = todayDay;
                    }
                    
                    // Save to localStorage for permanent storage
                    const calendarData = JSON.parse(localStorage.getItem('haven_calendar_data') || '{}');
                    calendarData[dateString] = {
                        mood: selectedMoodName,
                        intensity: selectedIntensityLevel,
                        color: intensityColor,
                        emoji: existingEmoji,
                        date: dateString
                    };
                    localStorage.setItem('haven_calendar_data', JSON.stringify(calendarData));
                    break;
                }
            }
            
            // Show confirmation (removed popup)
            
            // Reset selections
            selectedMoodColor = null;
            selectedMoodName = null;
            selectedMoodEmoji = null;
            selectedMoodLabel = null;
            selectedIntensityLevel = null;
            
            // Reset displays
            document.getElementById('selectedMoodDisplay').textContent = 'No mood selected yet';
            document.getElementById('selectedMoodDisplay').style.color = '#666';
            document.getElementById('selectedIntensityDisplay').textContent = 'No intensity selected';
            document.getElementById('selectedIntensityDisplay').style.color = '#666';
            
            // Reset buttons
            document.querySelectorAll('.intensity-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Disable add button
            const addBtn = document.getElementById('addToCalendarBtn');
            addBtn.disabled = true;
            addBtn.style.opacity = '0.6';
            addBtn.style.cursor = 'not-allowed';
        }

        // Global functions for simple calendar - must be defined first
        function renderSimpleCalendar() {
            // Get today's date for emoji preservation
            const today = new Date();
            const todayDay = today.getDate();
            
            // Store current emoji and styling before clearing
            const currentEmoji = (() => {
                const todayElement = Array.from(document.querySelectorAll('#simple-calendar-grid .calendar-day')).find(day => {
                    const dayText = day.textContent.trim();
                    const dayNumber = dayText.replace(/[😊😌😐😰😔]/g, '').trim();
                    return dayNumber === todayDay.toString();
                });
                if (todayElement) {
                    const emojiMatch = todayElement.textContent.match(/[😊😌😐😰😔]/);
                    return {
                        emoji: emojiMatch ? emojiMatch[0] : null,
                        background: todayElement.style.background,
                        color: todayElement.style.color,
                        fontWeight: todayElement.style.fontWeight
                    };
                }
                return null;
            })();
            
            const grid = document.getElementById('simple-calendar-grid');
            if (!grid) {
                return;
            }
            
            // Clear the grid
            grid.innerHTML = '';
            
            // Get current month info
            const firstDay = new Date(currentYearSimple, currentMonthSimple, 1);
            const lastDay = new Date(currentYearSimple, currentMonthSimple + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Update month display
            const monthDisplay = document.getElementById('current-month-simple');
            if (monthDisplay) {
                monthDisplay.textContent = monthNames[currentMonthSimple] + ' ' + currentYearSimple;
            }
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-weekday';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                grid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Check if today
                const today = new Date();
                if (day === today.getDate() && currentMonthSimple === today.getMonth() && currentYearSimple === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Add click handler
                dayElement.onclick = function() {
                    // Day clicked (removed popup)
                };
                
                grid.appendChild(dayElement);
            }
            
            // Restore emoji and styling if they existed before
            if (currentEmoji) {
                const todayElement = Array.from(document.querySelectorAll('#simple-calendar-grid .calendar-day')).find(day => {
                    return day.textContent.trim() === todayDay.toString();
                });
                if (todayElement) {
                    // Restore emoji
                    if (currentEmoji.emoji) {
                        todayElement.innerHTML = todayDay + ' ' + currentEmoji.emoji;
                    }
                    
                    // Restore styling
                    if (currentEmoji.background) todayElement.style.background = currentEmoji.background;
                    if (currentEmoji.color) todayElement.style.color = currentEmoji.color;
                    if (currentEmoji.fontWeight) todayElement.style.fontWeight = currentEmoji.fontWeight;
                }
            }
            
            // Load and display saved calendar data for all days
            setTimeout(loadSavedCalendarData, 100);
            
            // Calendar rendered (removed popup)
        }

        function previousMonthSimple() {
            currentMonthSimple--;
            if (currentMonthSimple < 0) {
                currentMonthSimple = 11;
                currentYearSimple--;
            }
            console.log('Simple calendar navigating to:', currentMonthSimple, currentYearSimple);
            renderSimpleCalendar();
        }
        
        function nextMonthSimple() {
            currentMonthSimple++;
            if (currentMonthSimple > 11) {
                currentMonthSimple = 0;
                currentYearSimple++;
            }
            console.log('Simple calendar navigating to:', currentMonthSimple, currentYearSimple);
            renderSimpleCalendar();
        }

        // DUPLICATE FUNCTION REMOVED

        // Global functions for mood calendar linking - must be defined first
        window.applyColorToCalendar = function(color) {
            const intensity = document.getElementById('enhancedIntensitySlider').value;
            const intensityFactor = intensity / 10;
            const adjustedColor = window.getColorWithIntensity(color, intensityFactor);
            
            const today = new Date();
            const todayDay = today.getDate();
            const dayElements = document.querySelectorAll('#simple-calendar-grid .calendar-day');
            
            for(let i = 0; i < dayElements.length; i++) {
                if(dayElements[i].textContent.trim() === todayDay.toString()) {
                    dayElements[i].style.background = adjustedColor;
                    dayElements[i].style.color = 'white';
                    dayElements[i].style.fontWeight = 'bold';
                    break;
                }
            }
            
            // Show which color was applied
            const colorNames = {
                '#E8447A': '🩷 Joyful',
                '#FFD93D': '🟡 Happy', 
                '#FF8C42': '🟠 Excited',
                '#87CEEB': '🔵 Calm',
                '#D3D3D3': '⚪ Neutral',
                '#8B4513': '🟤 Sad',
                '#2F4F4F': '🔘 Anxious',
                '#FF0000': '🔴 Angry'
            };
            
            const colorName = colorNames[color] || 'Mood';
            // Color applied (removed popup)
        }
        
        window.linkMoodToCalendar = function() {
            const intensity = document.getElementById('enhancedIntensitySlider').value;
            const selectedColor = window.selectedMoodColor || '#E8447A';
            const intensityFactor = intensity / 10;
            const adjustedColor = window.getColorWithIntensity(selectedColor, intensityFactor);
            
            const today = new Date();
            const todayDay = today.getDate();
            const dayElements = document.querySelectorAll('#simple-calendar-grid .calendar-day');
            
            for(let i = 0; i < dayElements.length; i++) {
                if(dayElements[i].textContent.trim() === todayDay.toString()) {
                    dayElements[i].style.background = adjustedColor;
                    dayElements[i].style.color = 'white';
                    dayElements[i].style.fontWeight = 'bold';
                    break;
                }
            }
            
            // Mood color applied (removed popup)
        }

        
        // Global functions - must be defined first
        function addMoodToToday(moodName, emoji, label) {
            // Get today's date
            const today = new Date();
            const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // Save mood to calendar
            saveMoodForDate(dateString, moodName, 5); // Default intensity of 5
            
            // Update calendar display
            renderCalendar();
            
            // Show confirmation (removed popup)
        }

        function linkToSimpleCalendar() {
            const moodDescription = document.getElementById('enhancedMoodDescription').value.trim();
            const intensity = document.getElementById('enhancedIntensitySlider').value;
            
            if (!moodDescription) {
                alert('Please describe your mood or emotions first.');
                return;
            }

            // Get today's date
            const today = new Date();
            const todayDay = today.getDate();
            
            // Generate simple emotional colors based on mood description
            const colors = generateSimpleEmotionalColors(moodDescription, intensity);
            
            // Apply colors to today in the simple calendar
            applyEmotionalColorsToCalendarDay(todayDay, colors);
            
            // Show confirmation
            alert(`Your emotional palette has been linked to today (day ${todayDay}) in the Simple Calendar! 🎨`);
        }

        function generateSimpleEmotionalColors(moodDescription, intensity) {
            const moodKeywords = moodDescription.toLowerCase();
            let colors = [];
            
            // Determine colors based on mood keywords
            if (moodKeywords.includes('happy') || moodKeywords.includes('joy') || moodKeywords.includes('excited')) {
                colors = ['#FFD93D', '#FF8C42', '#FF6B8A'];
            } else if (moodKeywords.includes('sad') || moodKeywords.includes('depressed') || moodKeywords.includes('melancholy')) {
                colors = ['#6C5CE7', '#A29BFE', '#74B9FF'];
            } else if (moodKeywords.includes('angry') || moodKeywords.includes('frustrated') || moodKeywords.includes('irritated')) {
                colors = ['#FF6B6B', '#FF8C42', '#FFD93D'];
            } else if (moodKeywords.includes('anxious') || moodKeywords.includes('worried') || moodKeywords.includes('nervous')) {
                colors = ['#FFD93D', '#FF8C42', '#FF6B8A'];
            } else if (moodKeywords.includes('calm') || moodKeywords.includes('peaceful') || moodKeywords.includes('serene')) {
                colors = ['#51CF66', '#74B9FF', '#A29BFE'];
            } else {
                // Default palette
                colors = ['#FF6B8A', '#FFD93D', '#51CF66'];
            }

            // Adjust intensity
            const intensityFactor = intensity / 10;
            return colors.map(color => adjustColorIntensity(color, intensityFactor));
        }

        function adjustColorIntensity(color, intensity) {
            // Simple color intensity adjustment
            const hex = color.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            const adjustedR = Math.min(255, Math.round(r * (0.5 + intensity * 0.5)));
            const adjustedG = Math.min(255, Math.round(g * (0.5 + intensity * 0.5)));
            const adjustedB = Math.min(255, Math.round(b * (0.5 + intensity * 0.5)));
            
            return `#${adjustedR.toString(16).padStart(2, '0')}${adjustedG.toString(16).padStart(2, '0')}${adjustedB.toString(16).padStart(2, '0')}`;
        }

        window.getColorWithIntensity = function(color, intensity) {
            // Comprehensive color intensity system (8 colors x 8 intensity levels)
            const colorIntensities = {
                '#E8447A': { // Dark Pink - Joyful
                    1: '#FFB3D1', 2: '#FF8AB8', 3: '#FF6B9A', 4: '#E8447A', 
                    5: '#D63384', 6: '#C41E3A', 7: '#A0152E', 8: '#7A0F22'
                },
                '#FFD93D': { // Yellow - Happy
                    1: '#FFF4CC', 2: '#FFEBA3', 3: '#FFE27A', 4: '#FFD93D', 
                    5: '#FFC107', 6: '#FFB300', 7: '#FF8F00', 8: '#FF6F00'
                },
                '#FF8C42': { // Orange - Excited
                    1: '#FFD4B3', 2: '#FFC19A', 3: '#FFAE81', 4: '#FF8C42', 
                    5: '#FF7A1A', 6: '#FF6800', 7: '#E55A00', 8: '#CC4D00'
                },
                '#87CEEB': { // Light Blue - Calm
                    1: '#E6F3F8', 2: '#D1E8F2', 3: '#BCDDEC', 4: '#87CEEB', 
                    5: '#5BC0DE', 6: '#2FB8E6', 7: '#1A9BC7', 8: '#0A7BA8'
                },
                '#D3D3D3': { // Gray - Neutral
                    1: '#F5F5F5', 2: '#E8E8E8', 3: '#DBDBDB', 4: '#D3D3D3', 
                    5: '#C0C0C0', 6: '#A9A9A9', 7: '#808080', 8: '#696969'
                },
                '#8B4513': { // Brown - Sad
                    1: '#D4A574', 2: '#C19A6B', 3: '#AE8F62', 4: '#8B4513', 
                    5: '#7A3A0A', 6: '#692F01', 7: '#582400', 8: '#471900'
                },
                '#2F4F4F': { // Dark Grey-Blue - Anxious
                    1: '#7A8B8B', 2: '#6A7A7A', 3: '#5A6969', 4: '#2F4F4F', 
                    5: '#1A3A3A', 6: '#052525', 7: '#001010', 8: '#000000'
                },
                '#FF0000': { // Red - Angry
                    1: '#FFB3B3', 2: '#FF8080', 3: '#FF4D4D', 4: '#FF0000', 
                    5: '#CC0000', 6: '#990000', 7: '#660000', 8: '#330000'
                }
            };
            
            // Get intensity level (1-8)
            const intensityLevel = Math.max(1, Math.min(8, Math.round(intensity * 8)));
            
            // Return appropriate color for this intensity level
            if (colorIntensities[color] && colorIntensities[color][intensityLevel]) {
                return colorIntensities[color][intensityLevel];
            }
            
            // Fallback to original color
            return color;
        }

        window.linkMoodToCalendar = function() {
            const intensity = document.getElementById('enhancedIntensitySlider').value;
            const selectedColor = window.selectedMoodColor || '#E8447A';
            const intensityFactor = intensity / 10;
            const adjustedColor = window.getColorWithIntensity(selectedColor, intensityFactor);
            
            const today = new Date();
            const todayDay = today.getDate();
            const dayElements = document.querySelectorAll('#simple-calendar-grid .calendar-day');
            
            for(let i = 0; i < dayElements.length; i++) {
                if(dayElements[i].textContent.trim() === todayDay.toString()) {
                    dayElements[i].style.background = adjustedColor;
                    dayElements[i].style.color = 'white';
                    dayElements[i].style.fontWeight = 'bold';
                    break;
                }
            }
            
            // Mood color applied (removed popup)
        }

        function applyEmotionalColorsToCalendarDay(day, colors) {
            // Find the day element in the simple calendar
            const dayElement = Array.from(document.querySelectorAll('#simple-calendar-grid .calendar-day')).find(dayEl => {
                return dayEl.textContent.trim() === day.toString();
            });
            
            if (dayElement) {
                // Create a gradient background using the emotional palette colors
                const gradientColors = colors.join(', ');
                dayElement.style.background = `linear-gradient(135deg, ${gradientColors})`;
                dayElement.style.color = 'white';
                dayElement.style.fontWeight = 'bold';
                dayElement.style.border = '2px solid #FF6B8A';
                console.log(`Applied colors to day ${day}: ${gradientColors}`);
            } else {
                console.log(`Day ${day} not found in calendar`);
            }
        }

        // Simple Calendar Implementation
        function createCalendar() {
            console.log('Creating calendar...');
            const grid = document.getElementById('calendar-grid');
            if (!grid) {
                console.error('Calendar grid not found');
                return;
            }
            
            // Clear the grid
            grid.innerHTML = '';
            
            // Use global month/year variables (or current date if not set)
            const displayMonth = currentMonth !== undefined ? currentMonth : new Date().getMonth();
            const displayYear = currentYear !== undefined ? currentYear : new Date().getFullYear();
            const firstDay = new Date(displayYear, displayMonth, 1);
            const lastDay = new Date(displayYear, displayMonth + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Update month display
            const monthDisplay = document.getElementById('current-month');
            if (monthDisplay) {
                monthDisplay.textContent = monthNames[displayMonth] + ' ' + displayYear;
            }
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-weekday';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                grid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Check if today (only highlight if viewing current month)
                const today = new Date();
                if (day === today.getDate() && displayMonth === today.getMonth() && displayYear === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Add click handler
                dayElement.onclick = function() {
                    selectMoodForDay(day);
                };
                
                grid.appendChild(dayElement);
            }
            
            console.log('Calendar created successfully!');
        }
        
        function selectMoodForDay(day) {
            const moodOptions = [
                { name: 'joyful', color: '#E8447A', emoji: '🩷', label: 'Joyful' },
                { name: 'happy', color: '#FFD93D', emoji: '🟡', label: 'Happy' },
                { name: 'excited', color: '#FF8C42', emoji: '🟠', label: 'Excited' },
                { name: 'calm', color: '#87CEEB', emoji: '🔵', label: 'Calm' },
                { name: 'neutral', color: '#D3D3D3', emoji: '⚪', label: 'Neutral' },
                { name: 'sad', color: '#8B4513', emoji: '🟤', label: 'Sad' },
                { name: 'anxious', color: '#2F4F4F', emoji: '🔘', label: 'Anxious' },
                { name: 'angry', color: '#FF0000', emoji: '🔴', label: 'Angry' }
            ];
            
            // Create simple mood selection
            let moodChoice = prompt('Select your mood for day ' + day + ':\n\n' + 
                moodOptions.map((mood, index) => (index + 1) + '. ' + mood.emoji + ' ' + mood.label).join('\n') + 
                '\n\nEnter the number (1-8):');
            
            if (moodChoice && moodChoice >= 1 && moodChoice <= 8) {
                const selectedMood = moodOptions[moodChoice - 1];
                alert('Mood saved: ' + selectedMood.emoji + ' ' + selectedMood.label + ' for day ' + day);
                
                // Save to localStorage
                const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
                const dateString = new Date().getFullYear() + '-' + 
                    String(new Date().getMonth() + 1).padStart(2, '0') + '-' + 
                    String(day).padStart(2, '0');
                moodData[dateString] = { mood: selectedMood.name, intensity: 5 };
                localStorage.setItem('haven_mood_calendar', JSON.stringify(moodData));
            }
        }
        
        // Global variables for current month/year
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            console.log('Navigating to:', currentMonth, currentYear);
            createCalendar();
        }
        
        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            console.log('Navigating to:', currentMonth, currentYear);
            createCalendar();
        }

        function renderCalendar() {
            const calendarContainer = document.getElementById('calendar-container');
            if (!calendarContainer) {
                console.error('Calendar container not found');
                return;
            }

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];

            // Update month/year display
            document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            // Clear previous calendar
            const calendarGrid = document.getElementById('calendar-grid');
            if (!calendarGrid) {
                console.error('Calendar grid not found');
                return;
            }
            calendarGrid.innerHTML = '';
            console.log('Calendar grid cleared and ready for population');

            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-weekday';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }

            // Add days of the month
            console.log(`Adding ${totalDays} days to calendar`);
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const moodData = getMoodForDate(dateString);
                
                if (moodData) {
                    dayElement.style.backgroundColor = getMoodColor(moodData.mood);
                    dayElement.style.color = 'white';
                    dayElement.style.fontWeight = 'bold';
                }

                // Check if today
                const today = new Date();
                if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayElement.classList.add('today');
                }

                dayElement.addEventListener('click', () => selectCalendarDay(day, dateString));
                calendarGrid.appendChild(dayElement);
            }
            console.log('Calendar population complete');
        }

        function getMoodColor(mood) {
            const colors = {
                'joyful': '#E8447A',
                'happy': '#FF9A8B',
                'excited': '#FFD93D',
                'calm': '#87CEEB',
                'neutral': '#D3D3D3',
                'sad': '#8B4513',
                'anxious': '#2F4F4F',
                'angry': '#FF0000'
            };
            return colors[mood] || '#D3D3D3';
        }

        function getMoodForDate(dateString) {
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            return moodData[dateString];
        }

        function saveMoodForDate(dateString, mood, intensity) {
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            moodData[dateString] = { mood, intensity };
            localStorage.setItem('haven_mood_calendar', JSON.stringify(moodData));
        }

        function selectCalendarDay(day, dateString) {
            // Create mood selection modal
            const moodOptions = [
                { name: 'joyful', color: '#E8447A', emoji: '🩷', label: 'Joyful' },
                { name: 'happy', color: '#FFD93D', emoji: '🟡', label: 'Happy' },
                { name: 'excited', color: '#FF8C42', emoji: '🟠', label: 'Excited' },
                { name: 'calm', color: '#87CEEB', emoji: '🔵', label: 'Calm' },
                { name: 'neutral', color: '#D3D3D3', emoji: '⚪', label: 'Neutral' },
                { name: 'sad', color: '#8B4513', emoji: '🟤', label: 'Sad' },
                { name: 'anxious', color: '#2F4F4F', emoji: '🔘', label: 'Anxious' },
                { name: 'angry', color: '#FF0000', emoji: '🔴', label: 'Angry' }
            ];

            // Create modal HTML
            let modalHTML = `
                <div id="moodModal" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                    align-items: center; justify-content: center;">
                    <div style="
                        background: white; padding: 30px; border-radius: 15px; 
                        max-width: 400px; width: 90%; text-align: center;">
                        <h3 style="margin-bottom: 20px; color: #333;">Select Mood for ${dateString}</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
            `;

            moodOptions.forEach(mood => {
                modalHTML += `
                    <button onclick="selectMoodForDay('${mood.name}', '${dateString}', ${day})" 
                            style="
                                padding: 15px; border: 2px solid ${mood.color}; 
                                background: ${mood.color}; color: white; border-radius: 10px; 
                                cursor: pointer; font-weight: bold; transition: transform 0.2s;">
                        ${mood.emoji} ${mood.label}
                    </button>
                `;
            });

            modalHTML += `
                        </div>
                        <button onclick="closeMoodModal()" 
                                style="
                                    padding: 10px 20px; background: #FF6B8A; color: white; 
                                    border: none; border-radius: 8px; cursor: pointer;">
                            Cancel
                        </button>
                    </div>
                </div>
            `;

            // Add modal to page
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function selectMoodForDay(moodName, dateString, day) {
            // Save mood to calendar
            saveMoodForDate(dateString, moodName, 5); // Default intensity of 5
            
            // Update calendar display
            renderCalendar();
            
            // Close modal
            closeMoodModal();
            
            // Show confirmation
            alert(`Mood "${moodName}" saved for ${dateString}! 📅`);
        }

        function closeMoodModal() {
            const modal = document.getElementById('moodModal');
            if (modal) {
                modal.remove();
            }
        }

        function addMoodToToday(moodName, emoji, label) {
            // Get today's date
            const today = new Date();
            const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // Save mood to calendar
            saveMoodForDate(dateString, moodName, 5); // Default intensity of 5
            
            // Update calendar display
            renderCalendar();
            
            // Show confirmation
            alert(`${emoji} ${label} mood added to today's calendar! 📅`);
        }

        function testCalendar() {
            console.log('=== CALENDAR TEST ===');
            console.log('Current month:', currentMonth);
            console.log('Current year:', currentYear);
            console.log('Calendar container exists:', !!document.getElementById('calendar-container'));
            console.log('Calendar grid exists:', !!document.getElementById('calendar-grid'));
            console.log('Current month element exists:', !!document.getElementById('current-month'));
            
            const today = new Date();
            console.log('Today:', today);
            console.log('Today\'s date:', today.getDate());
            console.log('Today\'s month:', today.getMonth());
            console.log('Today\'s year:', today.getFullYear());
            
            // Test mood data
            const testDate = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`;
            console.log('Test date:', testDate);
            console.log('Mood for test date:', getMoodForDate(testDate));
            
            // Force render
            console.log('Forcing calendar render...');
            renderCalendar();
            console.log('Calendar render complete');
        }

        function initializeCalendar() {
            console.log('Initializing calendar...');
            renderCalendar();
        }

        // Force calendar initialization on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM loaded, initializing calendar...');
                setTimeout(() => {
                    renderCalendar();
                }, 100);
            });
        } else {
            console.log('DOM already loaded, initializing calendar immediately...');
            setTimeout(() => {
                renderCalendar();
            }, 100);
        }

        function renderCalendar() {
            const calendarContainer = document.getElementById('calendar-container');
            if (!calendarContainer) {
                console.error('Calendar container not found');
                return;
            }

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];

            // Update month/year display
            document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            // Clear previous calendar
            const calendarGrid = document.getElementById('calendar-grid');
            if (!calendarGrid) {
                console.error('Calendar grid not found');
                return;
            }
            calendarGrid.innerHTML = '';
            console.log('Calendar grid cleared and ready for population');

            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-weekday';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }

            // Add days of the month
            console.log(`Adding ${totalDays} days to calendar`);
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const moodData = getMoodForDate(dateString);
                
                if (moodData) {
                    dayElement.style.backgroundColor = getMoodColor(moodData.mood);
                    dayElement.style.color = 'white';
                    dayElement.style.fontWeight = 'bold';
                }

                // Check if today
                const today = new Date();
                if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayElement.classList.add('today');
                }

                dayElement.addEventListener('click', () => selectCalendarDay(day, dateString));
                calendarGrid.appendChild(dayElement);
            }
            console.log('Calendar population complete');
        }

        function getMoodColor(mood) {
            const colors = {
                'joyful': '#E8447A',
                'happy': '#FF9A8B',
                'excited': '#FFD93D',
                'calm': '#87CEEB',
                'neutral': '#D3D3D3',
                'sad': '#8B4513',
                'anxious': '#2F4F4F',
                'angry': '#FF0000'
            };
            return colors[mood] || '#D3D3D3';
        }

        function getMoodForDate(dateString) {
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            return moodData[dateString];
        }

        function saveMoodForDate(dateString, mood, intensity) {
            const moodData = JSON.parse(localStorage.getItem('haven_mood_calendar') || '{}');
            moodData[dateString] = { mood, intensity };
            localStorage.setItem('haven_mood_calendar', JSON.stringify(moodData));
        }

        function selectCalendarDay(day, dateString) {
            // Create mood selection modal
            const moodOptions = [
                { name: 'joyful', color: '#E8447A', emoji: '🩷', label: 'Joyful' },
                { name: 'happy', color: '#FFD93D', emoji: '🟡', label: 'Happy' },
                { name: 'excited', color: '#FF8C42', emoji: '🟠', label: 'Excited' },
                { name: 'calm', color: '#87CEEB', emoji: '🔵', label: 'Calm' },
                { name: 'neutral', color: '#D3D3D3', emoji: '⚪', label: 'Neutral' },
                { name: 'sad', color: '#8B4513', emoji: '🟤', label: 'Sad' },
                { name: 'anxious', color: '#2F4F4F', emoji: '🔘', label: 'Anxious' },
                { name: 'angry', color: '#FF0000', emoji: '🔴', label: 'Angry' }
            ];

            // Create modal HTML
            let modalHTML = `
                <div id="moodModal" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                    align-items: center; justify-content: center;">
                    <div style="
                        background: white; padding: 30px; border-radius: 15px; 
                        max-width: 400px; width: 90%; text-align: center;">
                        <h3 style="margin-bottom: 20px; color: #333;">Select Mood for ${dateString}</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
            `;

            moodOptions.forEach(mood => {
                modalHTML += `
                    <button onclick="selectMoodForDay('${mood.name}', '${dateString}', ${day})" 
                            style="
                                padding: 15px; border: 2px solid ${mood.color}; 
                                background: ${mood.color}; color: white; border-radius: 10px; 
                                cursor: pointer; font-weight: bold; transition: transform 0.2s;">
                        ${mood.emoji} ${mood.label}
                    </button>
                `;
            });

            modalHTML += `
                        </div>
                        <button onclick="closeMoodModal()" 
                                style="
                                    padding: 10px 20px; background: #FF6B8A; color: white; 
                                    border: none; border-radius: 8px; cursor: pointer;">
                            Cancel
                        </button>
                    </div>
                </div>
            `;

            // Add modal to page
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function selectMoodForDay(moodName, dateString, day) {
            // Save mood to calendar
            saveMoodForDate(dateString, moodName, 5); // Default intensity of 5
            
            // Update calendar display
            renderCalendar();
            
            // Close modal
            closeMoodModal();
            
            // Show confirmation
            alert(`Mood "${moodName}" saved for ${dateString}! 📅`);
        }

        function closeMoodModal() {
            const modal = document.getElementById('moodModal');
            if (modal) {
                modal.remove();
            }
        }

        function addMoodToToday(moodName, emoji, label) {
            // Get today's date
            const today = new Date();
            const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // Save mood to calendar
            saveMoodForDate(dateString, moodName, 5); // Default intensity of 5
            
            // Update calendar display
            renderCalendar();
            
            // Show confirmation
            alert(`${emoji} ${label} mood added to today's calendar! 📅`);
        }

        function testCalendar() {
            console.log('=== CALENDAR TEST ===');
            console.log('Current month:', currentMonth);
            console.log('Current year:', currentYear);
            console.log('Calendar container exists:', !!document.getElementById('calendar-container'));
            console.log('Calendar grid exists:', !!document.getElementById('calendar-grid'));
            console.log('Current month element exists:', !!document.getElementById('current-month'));
            
            const today = new Date();
            console.log('Today:', today);
            console.log('Today\'s date:', today.getDate());
            console.log('Today\'s month:', today.getMonth());
            console.log('Today\'s year:', today.getFullYear());
            
            // Test mood data
            const testDate = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`;
            console.log('Test date:', testDate);
            console.log('Mood for test date:', getMoodForDate(testDate));
            
            // Force render
            console.log('Forcing calendar render...');
            renderCalendar();
            console.log('Calendar render complete');
        }

        function initializeCalendar() {
            console.log('Initializing calendar...');
            renderCalendar();
        }

        // Force calendar initialization on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM loaded, initializing calendar...');
                setTimeout(() => {
                    renderCalendar();
                }, 100);
            });
        } else {
            console.log('DOM already loaded, initializing calendar immediately...');
            setTimeout(() => {
                renderCalendar();
            }, 100);
        }

        // Other variables
        let selectedMood = null;
        let selectedIntensity = 5;
        
        // Initialize calendar when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(createCalendar, 100);
            });
        } else {
            setTimeout(createCalendar, 100);
        }



        function selectMood(mood, element) {
            // Remove selected class from all mood items
            document.querySelectorAll('.mood-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked item
            element.classList.add('selected');
            selectedMood = mood;
        }

        function saveJournalEntry() {
            const reflection = document.querySelector('.reflection-input').value;
            
            if (!selectedMood) {
                alert('Please select a mood first!');
                return;
            }
            
            if (!reflection.trim()) {
                alert('Please add a reflection before saving!');
                return;
            }
            
            // Create new entry
            const newEntry = {
                date: new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }),
                mood: selectedMood,
                reflection: reflection
            };
            
            // Save to localStorage
            let entries = JSON.parse(localStorage.getItem('haven_journal_entries') || '[]');
            entries.unshift(newEntry);
            localStorage.setItem('haven_journal_entries', JSON.stringify(entries));
            
            // Clear form
            document.querySelector('.reflection-input').value = '';
            document.querySelectorAll('.mood-item').forEach(item => {
                item.classList.remove('selected');
            });
            selectedMood = null;
            
            // Journal entry saved (removed popup)
            loadJournalEntries();
        }

        function loadJournalEntries() {
            const entries = JSON.parse(localStorage.getItem('haven_journal_entries') || '[]');
            const entriesList = document.getElementById('entriesList');
            
            if (entries.length === 0) {
                entriesList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No journal entries yet. Start by adding your first reflection!</p>';
                return;
            }
            
            entriesList.innerHTML = entries.map(entry => `
                <div class="entry-item">
                    <div class="entry-header">
                        <div class="entry-date">${entry.date}</div>
                        <div class="entry-mood">
                            <span class="entry-mood-emoji">${getMoodEmoji(entry.mood)}</span>
                            <span class="entry-mood-label">${getMoodLabel(entry.mood)}</span>
                        </div>
                    </div>
                    <div class="entry-content">"${entry.reflection}"</div>
                </div>
            `).join('');
        }

        function getMoodEmoji(mood) {
            const emojis = {
                'excited': '😊',
                'calm': '😌',
                'neutral': '😐',
                'anxious': '😰',
                'sad': '😔'
            };
            return emojis[mood] || '😐';
        }

        function getMoodLabel(mood) {
            const labels = {
                'excited': 'Happy',
                'calm': 'Calm',
                'neutral': 'Neutral',
                'anxious': 'Anxious',
                'sad': 'Sad'
            };
            return labels[mood] || 'Neutral';
        }

        function filterEntries(mood) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load and filter entries based on mood
            const entries = JSON.parse(localStorage.getItem('haven_journal_entries') || '[]');
            const entriesList = document.getElementById('entriesList');
            
            if (entries.length === 0) {
                entriesList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No journal entries yet. Start by adding your first reflection!</p>';
                return;
            }
            
            // Filter entries based on mood
            let filteredEntries = entries;
            if (mood !== 'all') {
                filteredEntries = entries.filter(entry => entry.mood === mood);
            }
            
            if (filteredEntries.length === 0) {
                entriesList.innerHTML = `<p style="text-align: center; color: #666; padding: 20px;">No ${mood} entries found. Try selecting "All" to see all entries.</p>`;
                return;
            }
            
            entriesList.innerHTML = filteredEntries.map(entry => `
                <div class="entry-item">
                    <div class="entry-header">
                        <div class="entry-date">${entry.date}</div>
                        <div class="entry-mood">
                            <span class="entry-mood-emoji">${getMoodEmoji(entry.mood)}</span>
                            <span class="entry-mood-label">${getMoodLabel(entry.mood)}</span>
                        </div>
                    </div>
                    <div class="entry-content">"${entry.reflection}"</div>
                </div>
            `).join('');
        }



        // Helper function to extract key phrases from insights
        function extractKeyPhrase(text) {
            if (!text) return 'Insights';
            
            // Extract the first meaningful phrase (up to 3-4 words)
            const words = text.split(' ').slice(0, 4);
            return words.join(' ');
        }

        // Load emotional insights from chat data
        async function loadEmotionalInsights() {
            try {
                // Get user ID from localStorage or generate one
                const userId = localStorage.getItem('havenUserId') || 'user-' + Date.now();
                localStorage.setItem('havenUserId', userId);
                
                // Get conversation history from localStorage
                const conversationHistory = JSON.parse(localStorage.getItem('havenConversations') || '[]');
                
                // If no conversations exist, show fallback content immediately
                if (conversationHistory.length === 0) {
                    console.log('No conversation history found, showing fallback insights');
                    setFallbackEmotionalInsights();
                    return;
                }
                
                const response = await fetch('/api/extract-insights', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        conversationHistory: conversationHistory,
                        pageType: 'journal'
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.insights) {
                    // Update the emotional insight cards with real data
                    const growthPattern = data.insights.growthPatterns[0] || 'Your growth patterns will emerge as you engage with Haven';
                    const strengthDiscovery = data.insights.strengthDiscoveries[0] || 'Your strengths will be discovered through your interactions';
                    const nextGrowthEdge = data.insights.nextGrowthEdges[0] || 'Your next growth opportunities will be identified as you continue your journey';
                    const emotionalTrend = data.insights.moodTrends[0] || 'Your emotional patterns are being analyzed';
                    
                    // Extract key phrases for display
                    document.getElementById('adding-growth-pattern').textContent = extractKeyPhrase(growthPattern);
                    document.getElementById('adding-growth-description').textContent = growthPattern;
                    
                    document.getElementById('adding-strength-discovery').textContent = extractKeyPhrase(strengthDiscovery);
                    document.getElementById('adding-strength-description').textContent = strengthDiscovery;
                    
                    document.getElementById('adding-next-growth-edge').textContent = extractKeyPhrase(nextGrowthEdge);
                    document.getElementById('adding-next-growth-description').textContent = nextGrowthEdge;
                    
                    document.getElementById('adding-learning-trend').textContent = extractKeyPhrase(emotionalTrend);
                    document.getElementById('adding-learning-trend-description').textContent = emotionalTrend;
                    
                    // Add loading animation
                    document.getElementById('adding-insights-container').style.opacity = '1';
                } else {
                    console.error('Failed to load emotional insights:', data.error);
                    // Show fallback content
                    setFallbackEmotionalInsights();
                }
            } catch (error) {
                console.error('Error loading emotional insights:', error);
                // Show fallback content
                setFallbackEmotionalInsights();
            }
        }

        function setFallbackEmotionalInsights() {
            document.getElementById('adding-growth-pattern').textContent = 'Growth Patterns';
            document.getElementById('adding-growth-description').textContent = 'Start your journey with Haven to discover your growth patterns';
            
            document.getElementById('adding-strength-discovery').textContent = 'Your Strengths';
            document.getElementById('adding-strength-description').textContent = 'Your strengths will emerge as you engage with Haven';
            
            document.getElementById('adding-next-growth-edge').textContent = 'Next Steps';
            document.getElementById('adding-next-growth-description').textContent = 'Begin conversations to identify your next growth opportunities';
            
            document.getElementById('adding-learning-trend').textContent = 'Emotional Trends';
            document.getElementById('adding-learning-trend-description').textContent = 'Your emotional patterns will be analyzed as you continue your journey';
        }

        // Mood Colors Functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Intensity slider functionality
            const intensitySlider = document.getElementById('intensitySlider');
            const intensityValue = document.getElementById('intensityValue');
            
            if (intensitySlider && intensityValue) {
                intensitySlider.addEventListener('input', function() {
                    intensityValue.textContent = this.value;
                    selectedIntensity = this.value;
                });
            }
            
            // Load existing entries
            loadJournalEntries();
            
            // Load compassion practice progress
            loadCompassionProgress();
            
            // Load emotional insights from chat data
            loadEmotionalInsights();
            
            // Initialize calendar
            initializeCalendar();
        });

        function generateMoodColors() {
            const moodDescription = document.getElementById('moodDescription').value.trim();
            const intensity = document.getElementById('intensitySlider').value;
            
            if (!moodDescription) {
                alert('Please describe your mood or emotions first.');
                return;
            }

            // Show loading state
            const button = document.querySelector('.generate-mood-button');
            const originalText = button.innerHTML;
            button.innerHTML = '🎨 Generating...';
            button.disabled = true;

            // Simulate API call with setTimeout
            setTimeout(() => {
                // Generate color palette based on mood and intensity
                const palette = generateColorPalette(moodDescription, intensity);
                displayMoodPalette(palette);
                
                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }

        function generateColorPalette(moodDescription, intensity) {
            // Simple color generation based on mood keywords
            const moodKeywords = moodDescription.toLowerCase();
            let baseColors = [];
            
            if (moodKeywords.includes('happy') || moodKeywords.includes('joy') || moodKeywords.includes('excited')) {
                baseColors = ['#FFD93D', '#FF8C42', '#FF6B8A', '#51CF66'];
            } else if (moodKeywords.includes('sad') || moodKeywords.includes('depressed') || moodKeywords.includes('melancholy')) {
                baseColors = ['#6C5CE7', '#A29BFE', '#74B9FF', '#55A3FF'];
            } else if (moodKeywords.includes('angry') || moodKeywords.includes('frustrated') || moodKeywords.includes('irritated')) {
                baseColors = ['#FF6B6B', '#FF8C42', '#FFD93D', '#FF6B8A'];
            } else if (moodKeywords.includes('anxious') || moodKeywords.includes('worried') || moodKeywords.includes('nervous')) {
                baseColors = ['#FFD93D', '#FF8C42', '#FF6B8A', '#74B9FF'];
            } else if (moodKeywords.includes('calm') || moodKeywords.includes('peaceful') || moodKeywords.includes('serene')) {
                baseColors = ['#51CF66', '#74B9FF', '#A29BFE', '#6C5CE7'];
            } else {
                // Default palette
                baseColors = ['#FF6B8A', '#FFD93D', '#51CF66', '#74B9FF'];
            }

            // Adjust intensity
            const intensityFactor = intensity / 10;
            const adjustedColors = baseColors.map(color => adjustColorIntensity(color, intensityFactor));
            
            return {
                name: `Mood Palette - ${new Date().toLocaleDateString()}`,
                colors: adjustedColors,
                description: moodDescription,
                intensity: intensity
            };
        }

        function adjustColorIntensity(color, intensity) {
            // Simple color intensity adjustment
            const hex = color.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            const adjustedR = Math.min(255, Math.round(r * (0.5 + intensity * 0.5)));
            const adjustedG = Math.min(255, Math.round(g * (0.5 + intensity * 0.5)));
            const adjustedB = Math.min(255, Math.round(b * (0.5 + intensity * 0.5)));
            
            return `#${adjustedR.toString(16).padStart(2, '0')}${adjustedG.toString(16).padStart(2, '0')}${adjustedB.toString(16).padStart(2, '0')}`;
        }

        function displayMoodPalette(palette) {
            const container = document.getElementById('moodPalettesContainer');
            
            const paletteHTML = `
                <div class="mood-palette-item">
                    <div class="mood-palette-header">
                        <h4 class="mood-palette-name">${palette.name}</h4>
                        <button onclick="deletePalette(this)" class="mood-palette-delete">×</button>
                    </div>
                    <div class="mood-palette-colors">
                        ${palette.colors.map(color => `
                            <div class="mood-color-swatch" style="background: ${color};"></div>
                        `).join('')}
                    </div>
                    <div class="mood-palette-details">
                        <div style="margin-bottom: 5px;"><strong>Mood:</strong> ${palette.description}</div>
                        <div><strong>Intensity:</strong> ${palette.intensity}/10</div>
                    </div>
                </div>
            `;
            
            container.innerHTML = paletteHTML + container.innerHTML;
        }

        // Emotional Palette Functions
        let selectedEnergy = null;
        let currentEmotionalPalette = null;

        // Energy button selection
        document.addEventListener('DOMContentLoaded', function() {
            const energyButtons = document.querySelectorAll('.energy-btn');
            energyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove selected class from all buttons
                    energyButtons.forEach(btn => btn.classList.remove('selected'));
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    selectedEnergy = this.getAttribute('data-energy');
                    
                    // Enable generate button
                    document.getElementById('generateEmotionalBtn').disabled = false;
                });
            });
        });

        function generateEmotionalColors() {
            if (!selectedEnergy) {
                alert('Please select your energy level first.');
                return;
            }

            const button = document.getElementById('generateEmotionalBtn');
            const originalText = button.innerHTML;
            button.innerHTML = '🎨 Generating...';
            button.disabled = true;

            // Simulate generation delay
            setTimeout(() => {
                const palette = generateEmotionalPalette(selectedEnergy);
                displayEmotionalPalette(palette);
                
                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }

        function generateEmotionalPalette(energy) {
            const colorSets = {
                calm: {
                    colors: ['#74B9FF', '#A29BFE', '#51CF66', '#6C5CE7'],
                    interpretation: 'Your calm energy creates a soothing palette of blues and purples, suggesting inner peace and reflection. The green tones indicate growth and stability.'
                },
                intense: {
                    colors: ['#FF6B6B', '#FF8C42', '#FFD93D', '#E17055'],
                    interpretation: 'Your intense energy manifests as vibrant reds and oranges, showing passion and strong emotions. The yellow suggests optimism even in intensity.'
                },
                mixed: {
                    colors: ['#FF6B8A', '#74B9FF', '#FFD93D', '#A29BFE'],
                    interpretation: 'Your mixed energy creates a balanced palette with both warm and cool tones, reflecting the complexity of your emotional state.'
                },
                uncertain: {
                    colors: ['#D3D3D3', '#A29BFE', '#FFD93D', '#74B9FF'],
                    interpretation: 'Your uncertain energy shows through muted tones with hints of color, suggesting you\'re processing and seeking clarity.'
                }
            };

            const selectedSet = colorSets[energy];
            
            return {
                energy: energy,
                colors: selectedSet.colors,
                interpretation: selectedSet.interpretation,
                timestamp: new Date().toISOString()
            };
        }

        function displayEmotionalPalette(palette) {
            currentEmotionalPalette = palette;
            
            const paletteContainer = document.getElementById('emotionalPalette');
            const interpretationContainer = document.getElementById('colorInterpretation');
            
            // Generate color circles
            paletteContainer.innerHTML = palette.colors.map((color, index) => `
                <div class="emotional-color" 
                     style="background: ${color};" 
                     data-color="${color}"
                     onclick="showColorDetails('${color}', ${index})">
                </div>
            `).join('');
            
            // Show interpretation
            interpretationContainer.innerHTML = `
                <h4>Your Emotional Interpretation</h4>
                <p>${palette.interpretation}</p>
            `;
            
            // Show the display sections
            document.getElementById('emotionalColorsDisplay').style.display = 'block';
            document.getElementById('savePaletteSection').style.display = 'block';
            document.getElementById('reflectionQuestions').style.display = 'block';
        }

        function showColorDetails(color, index) {
            const colorNames = {
                '#74B9FF': 'Calm Blue',
                '#A29BFE': 'Peaceful Purple', 
                '#51CF66': 'Growth Green',
                '#6C5CE7': 'Deep Purple',
                '#FF6B6B': 'Passionate Red',
                '#FF8C42': 'Energetic Orange',
                '#FFD93D': 'Optimistic Yellow',
                '#E17055': 'Warm Orange',
                '#FF6B8A': 'Haven Pink',
                '#D3D3D3': 'Uncertain Gray'
            };
            
            const colorName = colorNames[color] || color;
            alert(`Color ${index + 1}: ${colorName}\n\nThis color represents a specific aspect of your emotional state. Take a moment to reflect on how this color makes you feel.`);
        }

        function saveEmotionalPalette() {
            if (!currentEmotionalPalette) {
                alert('No palette to save. Please generate colors first.');
                return;
            }

            // Save to localStorage
            const savedPalettes = JSON.parse(localStorage.getItem('emotionalPalettes') || '[]');
            savedPalettes.unshift(currentEmotionalPalette);
            
            // Keep only last 10 palettes
            if (savedPalettes.length > 10) {
                savedPalettes.splice(10);
            }
            
            localStorage.setItem('emotionalPalettes', JSON.stringify(savedPalettes));
            
            // Show comparison
            showPaletteComparison();
            
            alert('Your emotional palette has been saved! 💾');
        }

        function showPaletteComparison() {
            const savedPalettes = JSON.parse(localStorage.getItem('emotionalPalettes') || '[]');
            const comparisonContainer = document.getElementById('paletteComparison');
            
            if (savedPalettes.length > 1) {
                const previousPalette = savedPalettes[1]; // Second most recent
                comparisonContainer.innerHTML = `
                    <h4>Comparison with Previous Palette</h4>
                    <p><strong>Previous Energy:</strong> ${previousPalette.energy}</p>
                    <p><strong>Current Energy:</strong> ${currentEmotionalPalette.energy}</p>
                    <p>Notice how your emotional colors have evolved. This can help you track your emotional journey over time.</p>
                `;
            } else {
                comparisonContainer.innerHTML = `
                    <p>This is your first saved palette. As you create more, you'll see comparisons here.</p>
                `;
            }
        }

        // Enhanced Emotional Palette Functions
        let enhancedSelectedEnergy = null;
        let currentEnhancedEmotionalPalette = null;

        // Enhanced energy button selection
        document.addEventListener('DOMContentLoaded', function() {
            const enhancedEnergyButtons = document.querySelectorAll('.energy-btn');
            enhancedEnergyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove selected class from all buttons
                    enhancedEnergyButtons.forEach(btn => btn.classList.remove('selected'));
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    enhancedSelectedEnergy = this.getAttribute('data-energy');
                    
                    // Enable generate button
                    document.getElementById('generateEnhancedEmotionalBtn').disabled = false;
                });
            });

            // Enhanced intensity slider
            const enhancedIntensitySlider = document.getElementById('enhancedIntensitySlider');
            const enhancedIntensityValue = document.getElementById('enhancedIntensityValue');
            
            if (enhancedIntensitySlider && enhancedIntensityValue) {
                enhancedIntensitySlider.addEventListener('input', function() {
                    enhancedIntensityValue.textContent = this.value;
                });
            }
        });

        function generateEnhancedEmotionalColors() {
            const moodDescription = document.getElementById('enhancedMoodDescription').value.trim();
            const intensity = document.getElementById('enhancedIntensitySlider').value;
            
            if (!moodDescription) {
                alert('Please describe your mood or emotions first.');
                return;
            }

            if (!enhancedSelectedEnergy) {
                alert('Please select your energy level first.');
                return;
            }

            const button = document.getElementById('generateEnhancedEmotionalBtn');
            const originalText = button.innerHTML;
            button.innerHTML = '🎨 Generating...';
            button.disabled = true;

            // Simulate generation delay
            setTimeout(() => {
                const palette = generateEnhancedEmotionalPalette(moodDescription, intensity, enhancedSelectedEnergy);
                displayEnhancedEmotionalPalette(palette);
                
                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }

        function generateEnhancedEmotionalPalette(moodDescription, intensity, energy) {
            // Analyze mood keywords from text input
            const moodKeywords = moodDescription.toLowerCase();
            let baseColors = [];
            
            // Determine base colors from text analysis
            if (moodKeywords.includes('happy') || moodKeywords.includes('joy') || moodKeywords.includes('excited')) {
                baseColors = ['#FFD93D', '#FF8C42', '#FF6B8A', '#51CF66'];
            } else if (moodKeywords.includes('sad') || moodKeywords.includes('depressed') || moodKeywords.includes('melancholy')) {
                baseColors = ['#6C5CE7', '#A29BFE', '#74B9FF', '#55A3FF'];
            } else if (moodKeywords.includes('angry') || moodKeywords.includes('frustrated') || moodKeywords.includes('irritated')) {
                baseColors = ['#FF6B6B', '#FF8C42', '#FFD93D', '#FF6B8A'];
            } else if (moodKeywords.includes('anxious') || moodKeywords.includes('worried') || moodKeywords.includes('nervous')) {
                baseColors = ['#FFD93D', '#FF8C42', '#FF6B8A', '#74B9FF'];
            } else if (moodKeywords.includes('calm') || moodKeywords.includes('peaceful') || moodKeywords.includes('serene')) {
                baseColors = ['#51CF66', '#74B9FF', '#A29BFE', '#6C5CE7'];
            } else {
                // Default palette
                baseColors = ['#FF6B8A', '#FFD93D', '#51CF66', '#74B9FF'];
            }

            // Adjust colors based on energy level
            const energyAdjustments = {
                calm: { saturation: 0.7, brightness: 1.1 },
                intense: { saturation: 1.3, brightness: 1.2 },
                mixed: { saturation: 1.0, brightness: 1.0 },
                uncertain: { saturation: 0.6, brightness: 0.9 }
            };

            const adjustment = energyAdjustments[energy];
            const adjustedColors = baseColors.map(color => adjustColorForEnergy(color, adjustment, intensity));

            // Generate interpretation based on all inputs
            const interpretation = generateEnhancedInterpretation(moodDescription, intensity, energy, adjustedColors);

            return {
                moodDescription: moodDescription,
                intensity: intensity,
                energy: energy,
                colors: adjustedColors,
                interpretation: interpretation,
                timestamp: new Date().toISOString()
            };
        }

        function adjustColorForEnergy(color, adjustment, intensity) {
            // Convert hex to HSL for better color manipulation
            const hex = color.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            // Apply energy and intensity adjustments
            const intensityFactor = intensity / 10;
            const adjustedR = Math.min(255, Math.round(r * adjustment.brightness * (0.5 + intensityFactor * 0.5)));
            const adjustedG = Math.min(255, Math.round(g * adjustment.brightness * (0.5 + intensityFactor * 0.5)));
            const adjustedB = Math.min(255, Math.round(b * adjustment.brightness * (0.5 + intensityFactor * 0.5)));
            
            return `#${adjustedR.toString(16).padStart(2, '0')}${adjustedG.toString(16).padStart(2, '0')}${adjustedB.toString(16).padStart(2, '0')}`;
        }

        function generateEnhancedInterpretation(moodDescription, intensity, energy, colors) {
            const energyDescriptions = {
                calm: 'Your calm energy creates a soothing palette',
                intense: 'Your intense energy manifests as vibrant colors',
                mixed: 'Your mixed energy creates a balanced palette',
                uncertain: 'Your uncertain energy shows through muted tones'
            };

            const intensityDescriptions = {
                low: 'with subtle, gentle tones',
                medium: 'with moderate, balanced tones',
                high: 'with bold, expressive tones'
            };

            let intensityLevel = 'medium';
            if (intensity <= 3) intensityLevel = 'low';
            else if (intensity >= 8) intensityLevel = 'high';

            return `${energyDescriptions[energy]} ${intensityDescriptions[intensityLevel]}, reflecting your current emotional state. The colors suggest ${getMoodKeywords(moodDescription)}.`;
        }

        function getMoodKeywords(moodDescription) {
            const keywords = moodDescription.toLowerCase();
            if (keywords.includes('happy') || keywords.includes('joy')) return 'positive emotions and optimism';
            if (keywords.includes('sad') || keywords.includes('depressed')) return 'introspection and healing';
            if (keywords.includes('angry') || keywords.includes('frustrated')) return 'strong emotions seeking expression';
            if (keywords.includes('anxious') || keywords.includes('worried')) return 'nervous energy and anticipation';
            if (keywords.includes('calm') || keywords.includes('peaceful')) return 'inner peace and tranquility';
            return 'complex emotions and personal growth';
        }

        function displayEnhancedEmotionalPalette(palette) {
            currentEnhancedEmotionalPalette = palette;
            
            const paletteContainer = document.getElementById('enhancedEmotionalPalette');
            const interpretationContainer = document.getElementById('enhancedColorInterpretation');
            
            // Generate color circles
            paletteContainer.innerHTML = palette.colors.map((color, index) => `
                <div class="emotional-color" 
                     style="background: ${color};" 
                     data-color="${color}"
                     onclick="showEnhancedColorDetails('${color}', ${index})">
                </div>
            `).join('');
            
            // Show interpretation
            interpretationContainer.innerHTML = `
                <h4>Your Enhanced Emotional Interpretation</h4>
                <p>${palette.interpretation}</p>
                <p><strong>Mood:</strong> ${palette.moodDescription}</p>
                <p><strong>Intensity:</strong> ${palette.intensity}/10</p>
                <p><strong>Energy:</strong> ${palette.energy}</p>
            `;
            
            // Show the display sections
            document.getElementById('enhancedEmotionalColorsDisplay').style.display = 'block';
            document.getElementById('enhancedSavePaletteSection').style.display = 'block';
            document.getElementById('enhancedReflectionQuestions').style.display = 'block';
        }

        function showEnhancedColorDetails(color, index) {
            const colorNames = {
                '#74B9FF': 'Calm Blue',
                '#A29BFE': 'Peaceful Purple', 
                '#51CF66': 'Growth Green',
                '#6C5CE7': 'Deep Purple',
                '#FF6B6B': 'Passionate Red',
                '#FF8C42': 'Energetic Orange',
                '#FFD93D': 'Optimistic Yellow',
                '#E17055': 'Warm Orange',
                '#FF6B8A': 'Haven Pink',
                '#D3D3D3': 'Uncertain Gray'
            };
            
            const colorName = colorNames[color] || color;
            alert(`Color ${index + 1}: ${colorName}\n\nThis color represents a specific aspect of your emotional state based on your mood description, intensity level, and energy selection.`);
        }

        function saveEnhancedEmotionalPalette() {
            if (!currentEnhancedEmotionalPalette) {
                alert('No palette to save. Please generate colors first.');
                return;
            }

            // Save to localStorage
            const savedPalettes = JSON.parse(localStorage.getItem('enhancedEmotionalPalettes') || '[]');
            savedPalettes.unshift(currentEnhancedEmotionalPalette);
            
            // Keep only last 10 palettes
            if (savedPalettes.length > 10) {
                savedPalettes.splice(10);
            }
            
            localStorage.setItem('enhancedEmotionalPalettes', JSON.stringify(savedPalettes));
            
            // Show comparison
            showEnhancedPaletteComparison();
            
            alert('Your enhanced emotional palette has been saved! 💾');
        }

        function showEnhancedPaletteComparison() {
            const savedPalettes = JSON.parse(localStorage.getItem('enhancedEmotionalPalettes') || '[]');
            const comparisonContainer = document.getElementById('enhancedPaletteComparison');
            
            if (savedPalettes.length > 1) {
                const previousPalette = savedPalettes[1]; // Second most recent
                comparisonContainer.innerHTML = `
                    <h4>Enhanced Comparison with Previous Palette</h4>
                    <p><strong>Previous:</strong> ${previousPalette.moodDescription} (${previousPalette.intensity}/10 intensity, ${previousPalette.energy} energy)</p>
                    <p><strong>Current:</strong> ${currentEnhancedEmotionalPalette.moodDescription} (${currentEnhancedEmotionalPalette.intensity}/10 intensity, ${currentEnhancedEmotionalPalette.energy} energy)</p>
                    <p>Notice how your emotional colors have evolved based on your mood descriptions, intensity levels, and energy selections.</p>
                `;
            } else {
                comparisonContainer.innerHTML = `
                    <p>This is your first enhanced palette. As you create more, you'll see detailed comparisons here.</p>
                `;
            }
        }

        function deletePalette(button) {
            if (confirm('Delete this color palette?')) {
                button.closest('.mood-palette-item').remove();
                
                // Show placeholder if no palettes remain
                const container = document.getElementById('moodPalettesContainer');
                if (container.children.length === 0) {
                    container.innerHTML = 'Generated color palettes will appear here';
                }
            }
        }

        // Calendar functionality - Global scope






        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkPlanAccess();
            initializeCalendar();
            initializeSimpleCalendar();
            
            // Load saved calendar data after everything is initialized
            setTimeout(loadSavedCalendarData, 500);
        });

        // Add event listener for Enter key on promo code input
        document.addEventListener('DOMContentLoaded', function() {
            const promoCodeInput = document.getElementById('promoCodeInput');
            if (promoCodeInput) {
                promoCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applyPromoCodeFromInput();
                    }
                });
            }
        });

        // Check plan access for journal feature
        function checkPlanAccess() {
            const subscriptionData = JSON.parse(localStorage.getItem('havenSubscription') || '{}');
            const userPlan = subscriptionData.plan || 'starter';
            const promoCodeData = localStorage.getItem('havenPromoCodeData');
            
            // Check if user has a valid promo code (within 30 days)
            let hasValidPromoCode = false;
            if (promoCodeData) {
                try {
                    const promoData = JSON.parse(promoCodeData);
                    const currentTime = new Date().getTime();
                    const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000; // 30 days in milliseconds
                    
                    // Check if promo code is still valid (within 30 days)
                    if (currentTime - promoData.timestamp < thirtyDaysInMs) {
                        hasValidPromoCode = true;
                    } else {
                        // Promo code expired, remove it
                        localStorage.removeItem('havenPromoCodeData');
                    }
                } catch (e) {
                    // Invalid data, remove it
                    localStorage.removeItem('havenPromoCodeData');
                }
            }
            
            // Allow access if user has valid promo code or is on Regular+ plan
            if (userPlan === 'starter' && !hasValidPromoCode) {
                document.getElementById('planUpgradeOverlay').style.display = 'flex';
                // Hide journal content
                document.querySelectorAll('.section').forEach(section => {
                    section.style.display = 'none';
                });
            } else {
                // Show journal content and hide popup
                document.getElementById('planUpgradeOverlay').style.display = 'none';
                document.querySelectorAll('.section').forEach(section => {
                    section.style.display = 'block';
                });
            }
        }

        // Function to apply promo code from input field
        function applyPromoCodeFromInput() {
            const promoCodeInput = document.getElementById('promoCodeInput');
            const promoCode = promoCodeInput.value;
            
            if (!promoCode || promoCode.trim() === '') {
                alert('Please enter a promo code.');
                return;
            }

            const enteredCode = promoCode.trim().toUpperCase();
            
            // Check if it's the BETA30 code
            if (enteredCode === 'BETA30') {
                // Store promo code with timestamp for 30-day validation
                const promoData = {
                    code: enteredCode,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem('havenPromoCodeData', JSON.stringify(promoData));
                checkPlanAccess();
                alert('Promo code BETA30 applied! You now have access to the Journal for 30 days.');
                promoCodeInput.value = ''; // Clear the input
            } else {
                alert('Invalid promo code. Please try again.');
                promoCodeInput.value = ''; // Clear the input
            }
        }

        // Function to apply promo code (legacy - kept for compatibility)
        function applyPromoCode() {
            const promoCode = prompt('Enter promo code:');
            if (promoCode && promoCode.trim() !== '') {
                const enteredCode = promoCode.trim().toUpperCase();
                
                // Check if it's the BETA30 code
                if (enteredCode === 'BETA30') {
                    // Store promo code with timestamp for 30-day validation
                    const promoData = {
                        code: enteredCode,
                        timestamp: new Date().getTime()
                    };
                    localStorage.setItem('havenPromoCodeData', JSON.stringify(promoData));
                    checkPlanAccess();
                    alert('Promo code BETA30 applied! You now have access to the Journal for 30 days.');
                } else {
                    alert('Invalid promo code. Please try again.');
                }
            }
        }

        // Compassion Badge Tracking Functions
        function updateCompassionProgress() {
            const checkboxes = [
                'mindfulSelfCompassion1',
                'mindfulSelfCompassion2', 
                'mindfulSelfCompassion3',
                'mindfulSelfCompassion4',
                'mindfulSelfCompassion5'
            ];
            
            let completedCount = 0;
            checkboxes.forEach(id => {
                if (document.getElementById(id).checked) {
                    completedCount++;
                }
            });
            
            const progressPercentage = (completedCount / checkboxes.length) * 100;
            const progressFill = document.getElementById('compassionProgressFill');
            const progressText = document.getElementById('compassionProgressText');
            
            progressFill.style.width = progressPercentage + '%';
            progressText.textContent = Math.round(progressPercentage) + '% completed';
            
            // Check if all items are completed
            if (completedCount === checkboxes.length) {
                awardCompassionBadge();
            }
            
            // Save progress to localStorage
            saveCompassionProgress(completedCount);
        }
        
        function awardCompassionBadge() {
            const badgeDisplay = document.getElementById('compassionBadgeDisplay');
            
            // Check if badge was already earned today
            const today = new Date().toDateString();
            const earnedBadges = JSON.parse(localStorage.getItem('haven_compassion_badges') || '[]');
            
            if (!earnedBadges.includes(today)) {
                // Award the badge
                earnedBadges.push(today);
                localStorage.setItem('haven_compassion_badges', JSON.stringify(earnedBadges));
                
                // Show badge notification
                badgeDisplay.style.display = 'block';
                
                // Add link to badges page
                const badgeContent = badgeDisplay.querySelector('.badge-content');
                const viewBadgesLink = document.createElement('div');
                viewBadgesLink.innerHTML = '<a href="badges.html" style="color: #FF6B8A; text-decoration: underline; font-size: 0.8em; margin-top: 5px; display: block;">View all badges →</a>';
                badgeContent.appendChild(viewBadgesLink);
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    badgeDisplay.style.display = 'none';
                }, 5000);
                
                // Also save to general badge system
                saveToBadgeSystem('self-compassion-champion');
            }
        }
        
        function saveCompassionProgress(completedCount) {
            const today = new Date().toDateString();
            const progressData = JSON.parse(localStorage.getItem('haven_compassion_progress') || '{}');
            progressData[today] = completedCount;
            localStorage.setItem('haven_compassion_progress', JSON.stringify(progressData));
        }
        
        function loadCompassionProgress() {
            const today = new Date().toDateString();
            const progressData = JSON.parse(localStorage.getItem('haven_compassion_progress') || '{}');
            const todayProgress = progressData[today] || 0;
            
            // Restore checkbox states
            const checkboxes = [
                'mindfulSelfCompassion1',
                'mindfulSelfCompassion2', 
                'mindfulSelfCompassion3',
                'mindfulSelfCompassion4',
                'mindfulSelfCompassion5'
            ];
            
            for (let i = 0; i < checkboxes.length; i++) {
                const checkbox = document.getElementById(checkboxes[i]);
                checkbox.checked = i < todayProgress;
            }
            
            // Update progress display
            updateCompassionProgress();
            
            // Show badge if already earned today
            const earnedBadges = JSON.parse(localStorage.getItem('haven_compassion_badges') || '[]');
            if (earnedBadges.includes(today)) {
                document.getElementById('compassionBadgeDisplay').style.display = 'block';
            }
        }
        
        function saveToBadgeSystem(badgeId) {
            // Save to the main badge system for tracking across the app
            const badgeData = JSON.parse(localStorage.getItem('haven_badges') || '{}');
            if (!badgeData[badgeId]) {
                badgeData[badgeId] = {
                    earned: true,
                    earnedDate: new Date().toISOString(),
                    progress: 1,
                    maxProgress: 1
                };
                localStorage.setItem('haven_badges', JSON.stringify(badgeData));
            }
            
            // Also update the BadgeTracker if it exists
            if (window.badgeTracker && badgeId === 'self-compassion-champion') {
                window.badgeTracker.recordSelfCompassion();
            }
            
            // Track Self-Love Champion badge (daily)
            if (badgeId === 'self-compassion-champion' && typeof updateBadgeProgress === 'function') {
                updateBadgeProgress('self-love-champion', 1);
            }
        }

        // Simple Calendar Functions

        function initializeSimpleCalendar() {
            console.log('Initializing simple calendar...');
            console.log('Current month/year:', currentMonthSimple, currentYearSimple);
            renderSimpleCalendar();
            
            // Load saved calendar data after a short delay to ensure calendar is ready
            setTimeout(loadSavedCalendarData, 200);
        }

        // DUPLICATE FUNCTION REMOVED - using the one at the top

        function previousMonthSimple() {
            currentMonthSimple--;
            if (currentMonthSimple < 0) {
                currentMonthSimple = 11;
                currentYearSimple--;
            }
            console.log('Simple calendar navigating to:', currentMonthSimple, currentYearSimple);
            renderSimpleCalendar();
        }
        
        function nextMonthSimple() {
            currentMonthSimple++;
            if (currentMonthSimple > 11) {
                currentMonthSimple = 0;
                currentYearSimple++;
            }
            console.log('Simple calendar navigating to:', currentMonthSimple, currentYearSimple);
            renderSimpleCalendar();
        }



        function selectMoodAndLinkToCalendar(mood, element) {
            // Remove selected class from all mood items
            document.querySelectorAll('.mood-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked item
            element.classList.add('selected');
            selectedMood = mood;
            
            // Get today's date
            const today = new Date();
            const todayDay = today.getDate();
            
            // Highlight today in the simple calendar
            highlightTodayInSimpleCalendar();
            
            // Show confirmation (removed popup)
        }

        function highlightTodayInSimpleCalendar() {
            // Find today's day element in the simple calendar
            const today = new Date();
            const todayDay = today.getDate();
            
            // Get mood emoji mapping
            const moodEmojis = {
                'excited': '😊',
                'calm': '😌',
                'neutral': '😐',
                'anxious': '😰',
                'sad': '😔'
            };
            
            // Find today's element
            const todayElement = Array.from(document.querySelectorAll('#simple-calendar-grid .calendar-day')).find(day => {
                const dayText = day.textContent.trim();
                const dayNumber = dayText.replace(/[😊😌😐😰😔]/g, '').trim();
                return dayNumber === todayDay.toString();
            });
            
            if (todayElement) {
                const moodEmoji = moodEmojis[selectedMood] || '😊';
                
                // Preserve existing background color and styling
                const existingBackground = todayElement.style.background;
                const existingColor = todayElement.style.color;
                const existingFontWeight = todayElement.style.fontWeight;
                
                // Add emoji to the day
                todayElement.innerHTML = todayDay + ' ' + moodEmoji;
                
                // Restore existing styling
                if (existingBackground) todayElement.style.background = existingBackground;
                if (existingColor) todayElement.style.color = existingColor;
                if (existingFontWeight) todayElement.style.fontWeight = existingFontWeight;
                
                // If no existing styling, add default
                if (!existingBackground && !existingColor) {
                    todayElement.style.fontWeight = 'bold';
                }
                
                // Save to localStorage for permanent storage
                const today = new Date();
                const dateString = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
                const calendarData = JSON.parse(localStorage.getItem('haven_calendar_data') || '{}');
                
                // Update existing data or create new entry
                if (calendarData[dateString]) {
                    calendarData[dateString].emoji = moodEmoji;
                } else {
                    calendarData[dateString] = {
                        mood: selectedMood,
                        emoji: moodEmoji,
                        date: dateString
                    };
                }
                localStorage.setItem('haven_calendar_data', JSON.stringify(calendarData));
            }
        }

        // Load saved calendar data and apply to calendar
        function loadSavedCalendarData() {
            const calendarData = JSON.parse(localStorage.getItem('haven_calendar_data') || '{}');
            const dayElements = document.querySelectorAll('#simple-calendar-grid .calendar-day');
            
            if (dayElements.length === 0) {
                // Calendar not ready yet, try again in a moment
                setTimeout(loadSavedCalendarData, 100);
                return;
            }
            
            dayElements.forEach(dayElement => {
                const dayText = dayElement.textContent.trim();
                const dayNumber = dayText.replace(/[😊😌😐😰😔]/g, '').trim();
                
                if (dayNumber && dayNumber !== '') {
                    // Get current month/year for date construction
                    const currentDate = new Date(currentYearSimple, currentMonthSimple, parseInt(dayNumber));
                    const dateString = currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0') + '-' + String(currentDate.getDate()).padStart(2, '0');
                    
                    const savedData = calendarData[dateString];
                    if (savedData) {
                        // Apply saved styling
                        if (savedData.color) {
                            dayElement.style.background = savedData.color;
                            dayElement.style.color = 'white';
                            dayElement.style.fontWeight = 'bold';
                        }
                        
                        // Apply saved emoji
                        if (savedData.emoji) {
                            dayElement.innerHTML = dayNumber + ' ' + savedData.emoji;
                        }
                    }
                }
            });
        }

        async function upgradeToRegular() {
            try {
                console.log('Upgrading to Regular plan');
                
                const response = await fetch('/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ planType: 'regular' })
                });

                const data = await response.json();
                
                if (data.error) {
                    console.error('Checkout error:', data.error);
                    alert('Unable to start checkout. Please try again.');
                    return;
                }

                if (data.mock) {
                    alert('Payment system is in demo mode. Redirecting to success page for testing.');
                    // Redirect to success page for demo
                    window.location.href = data.url;
                    return;
                }

                // Redirect to Stripe Checkout
                window.location.href = data.url;
                
            } catch (error) {
                console.error('Upgrade error:', error);
                alert('Something went wrong. Please try again.');
            }
        }

        // Badge Tracking Functions
        function trackJournalBadge(badgeType) {
            const journalProgress = JSON.parse(localStorage.getItem('haven_journal_progress') || '{}');
            const currentProgress = journalProgress[badgeType] || 0;
            journalProgress[badgeType] = currentProgress + 1;
            localStorage.setItem('haven_journal_progress', JSON.stringify(journalProgress));
            
            console.log(`Journal badge progress updated: ${badgeType} = ${currentProgress + 1}`);
            
            // Check if badge should be earned
            checkBadgeCompletion(badgeType);
        }

        function trackPracticeBadge(practiceType) {
            const practiceProgress = JSON.parse(localStorage.getItem('haven_practice_progress') || '{}');
            const currentProgress = practiceProgress[practiceType] || 0;
            practiceProgress[practiceType] = currentProgress + 1;
            localStorage.setItem('haven_practice_progress', JSON.stringify(practiceProgress));
            
            console.log(`Practice badge progress updated: ${practiceType} = ${currentProgress + 1}`);
            
            // Check if badge should be earned
            checkBadgeCompletion(practiceType);
        }

        function trackSocialBadge(shareType) {
            const socialProgress = JSON.parse(localStorage.getItem('haven_social_progress') || '{}');
            const currentProgress = socialProgress[shareType] || 0;
            socialProgress[shareType] = currentProgress + 1;
            localStorage.setItem('haven_social_progress', JSON.stringify(socialProgress));
            
            console.log(`Social badge progress updated: ${shareType} = ${currentProgress + 1}`);
            
            // Update social sharing badges based on share type
            if (typeof window.badgeTracker !== 'undefined') {
                switch(shareType) {
                    case 'good_vibes_spreader':
                        window.badgeTracker.updateProgress('good-vibes-spreader', currentProgress + 1);
                        break;
                    case 'inspiration_ambassador':
                        window.badgeTracker.updateProgress('inspiration-ambassador', currentProgress + 1);
                        break;
                    case 'support_circle_builder':
                        window.badgeTracker.updateProgress('support-circle-builder', currentProgress + 1);
                        break;
                    case 'wellness_influencer':
                        window.badgeTracker.updateProgress('wellness-influencer', currentProgress + 1);
                        break;
                    case 'community_champion':
                        window.badgeTracker.updateProgress('community-champion', currentProgress + 1);
                        break;
                    case 'mental_health_advocate':
                        window.badgeTracker.updateProgress('mental-health-advocate', currentProgress + 1);
                        break;
                }
            }
            
            // Check if badge should be earned
            checkBadgeCompletion(shareType);
        }

        function updateBadgeProgress(badgeId, progress) {
            const badgeProgress = JSON.parse(localStorage.getItem('haven_badge_progress') || '{}');
            badgeProgress[badgeId] = progress;
            localStorage.setItem('haven_badge_progress', JSON.stringify(badgeProgress));
            
            console.log(`Badge progress updated: ${badgeId} = ${progress}`);
        }

        function trackWeeklyActivity(activityType) {
            if (typeof window.badgeTracker !== 'undefined' && window.badgeTracker.getWeekKey) {
                const weeklyActivities = JSON.parse(localStorage.getItem('haven_weekly_activities') || '{}');
                const currentWeek = window.badgeTracker.getWeekKey();
                
                if (!weeklyActivities[currentWeek]) {
                    weeklyActivities[currentWeek] = [];
                }
                
                // Add activity if not already tracked this week
                if (!weeklyActivities[currentWeek].includes(activityType)) {
                    weeklyActivities[currentWeek].push(activityType);
                    localStorage.setItem('haven_weekly_activities', JSON.stringify(weeklyActivities));
                    
                    // Update growth sprinter badge (4 different activities per week)
                    if (weeklyActivities[currentWeek].length <= 4) {
                        updateBadgeProgress('growth-sprinter', weeklyActivities[currentWeek].length);
                    }
                }
            }
        }

        function trackComfortZoneActivity(activityType) {
            if (typeof window.badgeTracker !== 'undefined' && window.badgeTracker.getWeekKey) {
                const weeklyComfortZone = JSON.parse(localStorage.getItem('haven_weekly_comfort_zone') || '{}');
                const currentWeek = window.badgeTracker.getWeekKey();
                
                if (!weeklyComfortZone[currentWeek]) {
                    weeklyComfortZone[currentWeek] = [];
                }
                
                // Add activity if not already tracked this week
                if (!weeklyComfortZone[currentWeek].includes(activityType)) {
                    weeklyComfortZone[currentWeek].push(activityType);
                    localStorage.setItem('haven_weekly_comfort_zone', JSON.stringify(weeklyComfortZone));
                    
                    // Update comfort zone crusher badge (2 activities per week)
                    if (weeklyComfortZone[currentWeek].length <= 2) {
                        updateBadgeProgress('comfort-zone-crusher', weeklyComfortZone[currentWeek].length);
                    }
                }
            }
        }

        function trackMonthlyActivity(activityType) {
            if (typeof window.badgeTracker !== 'undefined') {
                const currentMonth = new Date().getFullYear() + '-' + String(new Date().getMonth() + 1).padStart(2, '0');
                const monthlyActivities = JSON.parse(localStorage.getItem('haven_monthly_activities') || '{}');
                
                if (!monthlyActivities[currentMonth]) {
                    monthlyActivities[currentMonth] = {
                        daily_activity: 0,
                        gratitude_journal: 0,
                        wellness_activity: 0,
                        conversations: 0,
                        boundary_practice: 0
                    };
                }
                
                // Increment the specific activity type
                if (monthlyActivities[currentMonth][activityType] !== undefined) {
                    monthlyActivities[currentMonth][activityType]++;
                    localStorage.setItem('haven_monthly_activities', JSON.stringify(monthlyActivities));
                    
                    // Update monthly badges based on activity type
                    switch(activityType) {
                        case 'daily_activity':
                            if (monthlyActivities[currentMonth].daily_activity <= 20) {
                                updateBadgeProgress('monthly-champion', monthlyActivities[currentMonth].daily_activity);
                            }
                            break;
                        case 'gratitude_journal':
                            if (monthlyActivities[currentMonth].gratitude_journal <= 15) {
                                updateBadgeProgress('gratitude-master', monthlyActivities[currentMonth].gratitude_journal);
                            }
                            break;
                        case 'wellness_activity':
                            if (monthlyActivities[currentMonth].wellness_activity <= 25) {
                                updateBadgeProgress('wellness-warrior', monthlyActivities[currentMonth].wellness_activity);
                            }
                            break;
                        case 'conversations':
                            if (monthlyActivities[currentMonth].conversations <= 30) {
                                updateBadgeProgress('ei-scholar', monthlyActivities[currentMonth].conversations);
                            }
                            break;
                        case 'boundary_practice':
                            if (monthlyActivities[currentMonth].boundary_practice <= 8) {
                                updateBadgeProgress('boundary-boss', monthlyActivities[currentMonth].boundary_practice);
                            }
                            break;
                    }
                }
            }
        }

        function checkBadgeCompletion(badgeId) {
            // This function checks if a badge should be earned based on progress
            // For now, we'll just log the completion
            console.log(`Checking badge completion for: ${badgeId}`);
            
            // You can add specific logic here to determine when badges are earned
            // For example, if progress reaches certain thresholds
        }

        // Advanced Tracking Functions
        function trackDataAnalysis(daysAnalyzed) {
            if (typeof window.badgeTracker !== 'undefined') {
                // Track data detective badge (30 days of analysis)
                if (daysAnalyzed <= 30) {
                    updateBadgeProgress('data-detective', daysAnalyzed);
                }
            }
        }

        function trackGoalAchievement(goalType) {
            if (typeof window.badgeTracker !== 'undefined') {
                const goalProgress = JSON.parse(localStorage.getItem('haven_goal_progress') || '{}');
                const currentProgress = goalProgress[goalType] || 0;
                goalProgress[goalType] = currentProgress + 1;
                localStorage.setItem('haven_goal_progress', JSON.stringify(goalProgress));
                
                // Track goal getter badge (10 goals achieved)
                const totalGoals = Object.values(goalProgress).reduce((sum, count) => sum + count, 0);
                if (totalGoals <= 10) {
                    updateBadgeProgress('goal-getter', totalGoals);
                }
            }
        }

        function trackPatternBreak(patternType) {
            if (typeof window.badgeTracker !== 'undefined') {
                const patternProgress = JSON.parse(localStorage.getItem('haven_pattern_progress') || '{}');
                const currentProgress = patternProgress[patternType] || 0;
                patternProgress[patternType] = currentProgress + 1;
                localStorage.setItem('haven_pattern_progress', JSON.stringify(patternProgress));
                
                // Track pattern master badge (5 patterns broken)
                const totalPatterns = Object.keys(patternProgress).length;
                if (totalPatterns <= 5) {
                    updateBadgeProgress('pattern-master', totalPatterns);
                }
            }
        }

        function showBadgeNotification(badgeName) {
            // Create a notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #FF6B8A 0%, #FFD93D 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: bold;
                animation: slideIn 0.5s ease-out;
            `;
            notification.innerHTML = `🎉 New Badge Earned: ${badgeName}! 🌟`;
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function shareJournalEntry() {
            // Track social sharing badge
            if (typeof trackSocialBadge === 'function') {
                trackSocialBadge('good_vibes_spreader');
            }
            
            // Create shareable content
            const journalData = {
                morningMagic: document.querySelector('input[placeholder*="coffee"]')?.value || '',
                peoplePower: document.querySelector('input[placeholder*="bestie"]')?.value || '',
                personalWins: document.querySelector('input[placeholder*="task"]')?.value || '',
                homeComfort: document.querySelector('textarea[placeholder*="cozy"]')?.value || '',
                bodyHealth: document.querySelector('textarea[placeholder*="body"]')?.value || '',
                opportunitiesGrowth: document.querySelector('textarea[placeholder*="Learned"]')?.value || '',
                worldAroundMe: document.querySelector('textarea[placeholder*="Beautiful"]')?.value || ''
            };
            
            // Create share text
            let shareText = '✨ My Gratitude Journal Entry ✨\n\n';
            if (journalData.morningMagic) shareText += `🌅 Morning Magic: ${journalData.morningMagic}\n`;
            if (journalData.peoplePower) shareText += `💝 People Power: ${journalData.peoplePower}\n`;
            if (journalData.personalWins) shareText += `🎯 Personal Wins: ${journalData.personalWins}\n`;
            if (journalData.homeComfort) shareText += `🏠 Home & Comfort: ${journalData.homeComfort}\n`;
            if (journalData.bodyHealth) shareText += `💪 Body & Health: ${journalData.bodyHealth}\n`;
            if (journalData.opportunitiesGrowth) shareText += `🎨 Opportunities & Growth: ${journalData.opportunitiesGrowth}\n`;
            if (journalData.worldAroundMe) shareText += `🌍 World Around Me: ${journalData.worldAroundMe}\n`;
            
            shareText += '\n#Gratitude #Haven #Mindfulness';
            
            // Try to use Web Share API if available
            if (navigator.share) {
                navigator.share({
                    title: 'My Gratitude Journal',
                    text: shareText
                }).catch(console.error);
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('✨ Journal entry copied to clipboard! Share it with your loved ones! 🌟');
                }).catch(() => {
                    alert('✨ Journal entry ready to share! Copy and paste this:\n\n' + shareText);
                });
            }
        }
    </script>
</body>
</html> 